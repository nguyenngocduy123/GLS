webpackJsonp([26],{

/***/ 1055:
/***/ (function(module, exports, __webpack_require__) {

var map = {
	"./af": 677,
	"./af.js": 677,
	"./ar": 678,
	"./ar-dz": 679,
	"./ar-dz.js": 679,
	"./ar-kw": 680,
	"./ar-kw.js": 680,
	"./ar-ly": 681,
	"./ar-ly.js": 681,
	"./ar-ma": 682,
	"./ar-ma.js": 682,
	"./ar-sa": 683,
	"./ar-sa.js": 683,
	"./ar-tn": 684,
	"./ar-tn.js": 684,
	"./ar.js": 678,
	"./az": 685,
	"./az.js": 685,
	"./be": 686,
	"./be.js": 686,
	"./bg": 687,
	"./bg.js": 687,
	"./bm": 688,
	"./bm.js": 688,
	"./bn": 689,
	"./bn.js": 689,
	"./bo": 690,
	"./bo.js": 690,
	"./br": 691,
	"./br.js": 691,
	"./bs": 692,
	"./bs.js": 692,
	"./ca": 693,
	"./ca.js": 693,
	"./cs": 694,
	"./cs.js": 694,
	"./cv": 695,
	"./cv.js": 695,
	"./cy": 696,
	"./cy.js": 696,
	"./da": 697,
	"./da.js": 697,
	"./de": 698,
	"./de-at": 699,
	"./de-at.js": 699,
	"./de-ch": 700,
	"./de-ch.js": 700,
	"./de.js": 698,
	"./dv": 701,
	"./dv.js": 701,
	"./el": 702,
	"./el.js": 702,
	"./en-au": 703,
	"./en-au.js": 703,
	"./en-ca": 704,
	"./en-ca.js": 704,
	"./en-gb": 705,
	"./en-gb.js": 705,
	"./en-ie": 706,
	"./en-ie.js": 706,
	"./en-il": 707,
	"./en-il.js": 707,
	"./en-nz": 708,
	"./en-nz.js": 708,
	"./eo": 709,
	"./eo.js": 709,
	"./es": 710,
	"./es-do": 711,
	"./es-do.js": 711,
	"./es-us": 712,
	"./es-us.js": 712,
	"./es.js": 710,
	"./et": 713,
	"./et.js": 713,
	"./eu": 714,
	"./eu.js": 714,
	"./fa": 715,
	"./fa.js": 715,
	"./fi": 716,
	"./fi.js": 716,
	"./fo": 717,
	"./fo.js": 717,
	"./fr": 718,
	"./fr-ca": 719,
	"./fr-ca.js": 719,
	"./fr-ch": 720,
	"./fr-ch.js": 720,
	"./fr.js": 718,
	"./fy": 721,
	"./fy.js": 721,
	"./gd": 722,
	"./gd.js": 722,
	"./gl": 723,
	"./gl.js": 723,
	"./gom-latn": 724,
	"./gom-latn.js": 724,
	"./gu": 725,
	"./gu.js": 725,
	"./he": 726,
	"./he.js": 726,
	"./hi": 727,
	"./hi.js": 727,
	"./hr": 728,
	"./hr.js": 728,
	"./hu": 729,
	"./hu.js": 729,
	"./hy-am": 730,
	"./hy-am.js": 730,
	"./id": 731,
	"./id.js": 731,
	"./is": 732,
	"./is.js": 732,
	"./it": 733,
	"./it.js": 733,
	"./ja": 734,
	"./ja.js": 734,
	"./jv": 735,
	"./jv.js": 735,
	"./ka": 736,
	"./ka.js": 736,
	"./kk": 737,
	"./kk.js": 737,
	"./km": 738,
	"./km.js": 738,
	"./kn": 739,
	"./kn.js": 739,
	"./ko": 740,
	"./ko.js": 740,
	"./ky": 741,
	"./ky.js": 741,
	"./lb": 742,
	"./lb.js": 742,
	"./lo": 743,
	"./lo.js": 743,
	"./lt": 744,
	"./lt.js": 744,
	"./lv": 745,
	"./lv.js": 745,
	"./me": 746,
	"./me.js": 746,
	"./mi": 747,
	"./mi.js": 747,
	"./mk": 748,
	"./mk.js": 748,
	"./ml": 749,
	"./ml.js": 749,
	"./mn": 750,
	"./mn.js": 750,
	"./mr": 751,
	"./mr.js": 751,
	"./ms": 752,
	"./ms-my": 753,
	"./ms-my.js": 753,
	"./ms.js": 752,
	"./mt": 754,
	"./mt.js": 754,
	"./my": 755,
	"./my.js": 755,
	"./nb": 756,
	"./nb.js": 756,
	"./ne": 757,
	"./ne.js": 757,
	"./nl": 758,
	"./nl-be": 759,
	"./nl-be.js": 759,
	"./nl.js": 758,
	"./nn": 760,
	"./nn.js": 760,
	"./pa-in": 761,
	"./pa-in.js": 761,
	"./pl": 762,
	"./pl.js": 762,
	"./pt": 763,
	"./pt-br": 764,
	"./pt-br.js": 764,
	"./pt.js": 763,
	"./ro": 765,
	"./ro.js": 765,
	"./ru": 766,
	"./ru.js": 766,
	"./sd": 767,
	"./sd.js": 767,
	"./se": 768,
	"./se.js": 768,
	"./si": 769,
	"./si.js": 769,
	"./sk": 770,
	"./sk.js": 770,
	"./sl": 771,
	"./sl.js": 771,
	"./sq": 772,
	"./sq.js": 772,
	"./sr": 773,
	"./sr-cyrl": 774,
	"./sr-cyrl.js": 774,
	"./sr.js": 773,
	"./ss": 775,
	"./ss.js": 775,
	"./sv": 776,
	"./sv.js": 776,
	"./sw": 777,
	"./sw.js": 777,
	"./ta": 778,
	"./ta.js": 778,
	"./te": 779,
	"./te.js": 779,
	"./tet": 780,
	"./tet.js": 780,
	"./tg": 781,
	"./tg.js": 781,
	"./th": 782,
	"./th.js": 782,
	"./tl-ph": 783,
	"./tl-ph.js": 783,
	"./tlh": 784,
	"./tlh.js": 784,
	"./tr": 785,
	"./tr.js": 785,
	"./tzl": 786,
	"./tzl.js": 786,
	"./tzm": 787,
	"./tzm-latn": 788,
	"./tzm-latn.js": 788,
	"./tzm.js": 787,
	"./ug-cn": 789,
	"./ug-cn.js": 789,
	"./uk": 790,
	"./uk.js": 790,
	"./ur": 791,
	"./ur.js": 791,
	"./uz": 792,
	"./uz-latn": 793,
	"./uz-latn.js": 793,
	"./uz.js": 792,
	"./vi": 794,
	"./vi.js": 794,
	"./x-pseudo": 795,
	"./x-pseudo.js": 795,
	"./yo": 796,
	"./yo.js": 796,
	"./zh-cn": 797,
	"./zh-cn.js": 797,
	"./zh-hk": 798,
	"./zh-hk.js": 798,
	"./zh-tw": 799,
	"./zh-tw.js": 799
};
function webpackContext(req) {
	return __webpack_require__(webpackContextResolve(req));
};
function webpackContextResolve(req) {
	var id = map[req];
	if(!(id + 1)) // check for number or string
		throw new Error("Cannot find module '" + req + "'.");
	return id;
};
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = 1055;

/***/ }),

/***/ 1063:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return JobsTable; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return KeyValueTable; });
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
/**
 * Parent class of all tables. Defines the structure of each table
 *
 * @class Table
 */
var Table = /** @class */ (function () {
    function Table(name, version, // increment value whenever columns list is modified
    db, columns) {
        this.name = name;
        this.version = version;
        this.db = db;
        this.columns = columns;
    }
    /**
     * Execute SQL statement to create table
     *
     * @returns {Promise<boolean>}  True if executed successfully
     */
    Table.prototype.sqlCreate = function () {
        var sql = "CREATE TABLE IF NOT EXISTS " + this.name + " (" + this.getSchema() + ")";
        var params = [];
        return this.db.executeSql(sql, params).then(function () { return true; });
    };
    /**
     * Execute SQL statement to delete table
     *
     * @returns {Promise<boolean>}  True if executed successfully
     */
    Table.prototype.sqlDrop = function () {
        var sql = "DROP TABLE IF EXISTS " + this.name;
        var params = [];
        return this.db.executeSql(sql, params).then(function () { return true; });
    };
    /**
     * Gets the first row of data from dataset
     *
     * @protected
     * @param {ISQLResultSet} resultSet  SQL result set from executed SQL statement
     * @returns {*}  First row of data
     */
    Table.prototype.getFirstRow = function (resultSet) {
        return (resultSet.rows.length > 0) ? resultSet.rows.item(0) : undefined;
    };
    /**
     * Gets all rows of data from dataset. Data returned is immutable
     *
     * @protected
     * @param {ISQLResultSet} resultSet  SQL result set from executed SQL statement
     * @returns {*}  All rows of data
     */
    Table.prototype.getAllRows = function (resultSet) {
        var results = [];
        for (var i = 0; i < resultSet.rows.length; i++) {
            results.push(resultSet.rows.item(i));
        }
        return results;
    };
    /**
     * Get the row ID of the last inserted row. If result set is for multiple executed statements,
     * only the row ID of the last row will be returned
     *
     * @protected
     * @param {ISQLResultSet} resultSet  SQL result set from executed SQL statement
     * @returns {number}  Row ID
     */
    Table.prototype.getInsertedId = function (resultSet) {
        if (resultSet.rowsAffected > 0) {
            return resultSet.insertId;
        }
        else {
            throw new Error('Unable to store record in database');
        }
    };
    /**
     * Get the number of rows that were changed by the SQL statement
     *
     * @protected
     * @param {ISQLResultSet} resultSet  SQL result set from executed SQL statement
     * @returns {number}  Number of rows affected
     */
    Table.prototype.getRowsAffected = function (resultSet) {
        return resultSet.rowsAffected;
    };
    /**
     * Get schema of table in SQL query format
     *
     * @private
     * @returns {string}
     */
    Table.prototype.getSchema = function () {
        return this.columns.map(function (col) { return col.getSchema(); }).join(',');
    };
    return Table;
}());
/**
 * Represents one column of a table
 *
 * @class Column
 */
var Column = /** @class */ (function () {
    function Column(name, type, // https://github.com/litehelpers/Cordova-sqlite-storage#general-sqlite-pitfalls
    opts) {
        this.name = name;
        this.type = type;
        this.isJSON = false;
        this.isBase64 = false;
        this.isPrimaryKey = false;
        Object.assign(this, opts);
    }
    /**
     * Get schema of the column in SQL query format
     *
     * @returns {string}
     */
    Column.prototype.getSchema = function () {
        var specialKey = (this.isPrimaryKey) ? 'PRIMARY KEY' : '';
        return this.name + " " + this.type + " " + specialKey;
    };
    return Column;
}());
/**
 * Stores completed jobs that were not sent to server successfully
 *
 * @class JobsTable
 * @extends {Table}
 */
var JobsTable = /** @class */ (function (_super) {
    __extends(JobsTable, _super);
    function JobsTable(db) {
        return _super.call(this, 'jobs', 1, db, [
            new Column('jobId', 'INTEGER'),
            new Column('attemptedByDriver', 'TEXT'),
            new Column('attemptedByVehicle', 'TEXT'),
            new Column('delivered', 'BOOLEAN'),
            new Column('deliveryTime', 'TEXT'),
            new Column('signatureB64', 'TEXT', { isBase64: true }),
            new Column('photoB64', 'TEXT', { isBase64: true }),
            new Column('notePhotosB64', 'TEXT', { isJSON: true, isBase64: true }),
            new Column('note', 'TEXT', { isJSON: true }),
            new Column('items', 'TEXT', { isJSON: true }),
        ]) || this;
    }
    /**
     * Get all rows from `jobs` table
     *
     * @returns {Promise<IJobsColumns[]>}
     */
    JobsTable.prototype.sqlSelect = function () {
        var sql = "SELECT * FROM " + this.name;
        var params = [];
        return this.db.executeSql(sql, params).then(this.getAllRows);
    };
    /**
     * Execute SQL statement to insert one job into the `jobs` table
     *
     * @param {IJobsColumns} job  Job to be inserted
     * @returns {Promise<number>}  Row ID
     */
    JobsTable.prototype.sqlInsert = function (job) {
        var columns = [];
        var params = [];
        for (var key in job) {
            columns.push(key);
            params.push((job[key] instanceof Object) ? JSON.stringify(job[key]) : job[key]); // convert json objects to strings
        }
        var sql = "INSERT INTO " + this.name + " (" + columns.join(',') + ") VALUES (" + params.map(function () { return '?'; }) + ")";
        return this.db.executeSql(sql, params).then(this.getInsertedId);
    };
    /**
     * Execute SQL statement to delete one job based on row ID from the `jobs` table
     *
     * @param {number} id  Row ID
     * @returns {Promise<number>}  Number of rows affected
     */
    JobsTable.prototype.sqlDelete = function (id) {
        var sql = "DELETE FROM " + this.name + " WHERE rowId = ?";
        var params = [id];
        return this.db.executeSql(sql, params).then(function (resultSet) { return resultSet.rowsAffected; });
    };
    /**
     * Execute SQL statement to delete all rows from `jobs` table
     *
     * @returns {Promise<number>}  Number of rows affected
     */
    JobsTable.prototype.sqlDeleteAll = function () {
        var sql = "DELETE FROM " + this.name;
        var params = [];
        return this.db.executeSql(sql, params).then(function (resultSet) { return resultSet.rowsAffected; });
    };
    return JobsTable;
}(Table));

/**
 * Stores key value pairs. SQL storage is used instead of other means is to prevent
 * data from purging when memory size has reached its limits
 *
 * @class KeyValueTable
 * @extends {Table}
 */
var KeyValueTable = /** @class */ (function (_super) {
    __extends(KeyValueTable, _super);
    function KeyValueTable(db) {
        return _super.call(this, 'keyvalue', 1, db, [
            new Column('key', 'TEXT', { isPrimaryKey: true }),
            new Column('value', 'TEXT'),
        ]) || this;
    }
    /**
     * Execute SQL statement to get value that is mapped to a particular key
     *
     * @param {string} key  Unique identifier
     * @returns {Promise<string>}  Value that is linked to the `key`
     */
    KeyValueTable.prototype.sqlGetValue = function (key) {
        var sql = "SELECT value FROM " + this.name + " WHERE key = ?";
        var params = [key];
        return this.db.executeSql(sql, params).then(this.getFirstRow).then(function (row) { return row ? row.value : undefined; });
    };
    /**
     * Execute SQL statement to set value of a particular key.
     * If key exist, existing value is overwritten.
     * If key does not exist, key-value pair will be inserted
     *
     * @param {string} key  Unique identifier
     * @param {string} value  Value that is linked to the `key`
     * @returns {Promise<number>}  Number of rows affected
     */
    KeyValueTable.prototype.sqlSetValue = function (key, value) {
        var sql = "INSERT OR REPLACE INTO " + this.name + " VALUES (?, ?)";
        var params = [key, value];
        return this.db.executeSql(sql, params).then(this.getRowsAffected);
    };
    return KeyValueTable;
}(Table));

//# sourceMappingURL=sql-table.js.map

/***/ }),

/***/ 1065:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Item; });
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var Item = /** @class */ (function () {
    function Item(init) {
        Object.assign(this, init);
    }
    Object.defineProperty(Item.prototype, "Id", {
        get: function () { return this._Id; },
        set: function (id) { this._Id = id; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "Weight", {
        get: function () { return this._Weight; },
        set: function (weight) { this._Weight = weight; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Item.prototype, "Description", {
        get: function () { return this._Description; },
        set: function (description) { this._Description = description; },
        enumerable: true,
        configurable: true
    });
    return Item;
}());

//# sourceMappingURL=item.js.map

/***/ }),

/***/ 1066:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AuthResponse; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__globals__ = __webpack_require__(40);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */

var AuthResponse = /** @class */ (function () {
    function AuthResponse(init) {
        this.forceChangePassword = false;
        this.noteOptions = {
            option: {
                required: __WEBPACK_IMPORTED_MODULE_0__globals__["a" /* Globals */].setting.note.optionRequired,
                list: __WEBPACK_IMPORTED_MODULE_0__globals__["a" /* Globals */].setting.note.options,
            },
            photo: {
                maxCount: __WEBPACK_IMPORTED_MODULE_0__globals__["a" /* Globals */].setting.note.maxNumPhoto,
            },
        };
        this.podOptions = {
            photo: {
                required: __WEBPACK_IMPORTED_MODULE_0__globals__["a" /* Globals */].setting.pod.photoRequired,
            },
        };
        this.itemOptions = {
            input: {
                default: (__WEBPACK_IMPORTED_MODULE_0__globals__["a" /* Globals */].setting.item.defaultInput === __WEBPACK_IMPORTED_MODULE_0__globals__["b" /* ItemInputMethod */].Barcode) ? 'BARCODE' : 'TEXT',
                allowToggle: __WEBPACK_IMPORTED_MODULE_0__globals__["a" /* Globals */].setting.item.allowSwitchInput,
            },
            barcode: {
                formats: __WEBPACK_IMPORTED_MODULE_0__globals__["a" /* Globals */].setting.item.acceptedCodes,
            },
        };
        this.statusLabels = [];
        Object.assign(this, init);
    }
    return AuthResponse;
}());

//# sourceMappingURL=auth-response.js.map

/***/ }),

/***/ 1086:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return MyApp; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ngx_translate_core__ = __webpack_require__(545);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__ionic_native_keyboard__ = __webpack_require__(851);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__ionic_native_status_bar__ = __webpack_require__(852);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__ionic_native_splash_screen__ = __webpack_require__(853);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__ionic_native_network__ = __webpack_require__(220);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_rxjs_add_operator_distinctUntilChanged__ = __webpack_require__(857);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_rxjs_add_operator_distinctUntilChanged___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_7_rxjs_add_operator_distinctUntilChanged__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__globals__ = __webpack_require__(40);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__providers_user_auth__ = __webpack_require__(217);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__providers_driver_rest_native_http__ = __webpack_require__(521);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__providers_storage_storage__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12__providers_user_user_driver__ = __webpack_require__(137);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_13__providers_navigation_navigation__ = __webpack_require__(543);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};














var MyApp = /** @class */ (function (_super) {
    __extends(MyApp, _super);
    function MyApp(app, auth, driver, keyboard, menuCtrl, http, network, platform, statusBar, storage, splashScreen, translate) {
        var _this = _super.call(this, { app: app, platform: platform }) || this;
        _this.app = app;
        _this.auth = auth;
        _this.driver = driver;
        _this.keyboard = keyboard;
        _this.menuCtrl = menuCtrl;
        _this.http = http;
        _this.network = network;
        _this.platform = platform;
        _this.statusBar = statusBar;
        _this.storage = storage;
        _this.splashScreen = splashScreen;
        _this.translate = translate;
        _this.allJobsMenuId = __WEBPACK_IMPORTED_MODULE_8__globals__["c" /* MenuName */].AllJobs;
        _this.allJobsMenuPages = [
            { name: 'AllJobsPage', title: 'Today\'s Jobs', icon: 'checkmark-circle' },
            { name: 'PlannerNotesPage', title: 'Planner Notes', icon: 'list' },
            { name: 'NextDayJobsPage', title: 'Next Day Jobs', icon: 'calendar' },
        ];
        _this.initializeApp();
        return _this;
    }
    MyApp.prototype.initializeApp = function () {
        var _this = this;
        this.platform.ready()
            .then(function () { return _this.splashScreen.show(); })
            .then(function () { return _this.storage.init(); }) // init storage to set url first
            .then(function () {
            // timeout error after this time
            _this.http.setRequestTimeout(5);
            // send all data to server in json
            _this.http.setDataSerializer('json');
            // enable ssl pinning if specified in globals
            var sslCertMode = (__WEBPACK_IMPORTED_MODULE_8__globals__["a" /* Globals */].features.enableSSLPinning) ? 'pinned' : 'default';
            return _this.http.setSSLCertMode(sslCertMode).catch(function () { }); // catch for web usage
        })
            .then(function () {
            // TODO: create preference provider and set according to globalization
            // indicate supported languages
            _this.translate.addLangs(['en']);
            _this.translate.setDefaultLang('en');
        })
            .then(function () { return _this.auth.isLoggedIn().catch(function () { return _this.auth.notifier.next(false); }); }) // redirect to login page if any errors
            .then(function () {
            // hide menu for all pages
            _this.menuCtrl.enable(false, _this.allJobsMenuId);
            // hide footer when keyboard is open
            _this.keyboard.onKeyboardShow().subscribe(function () { return document.body.classList.add('keyboard-is-open'); });
            _this.keyboard.onKeyboardHide().subscribe(function () { return document.body.classList.remove('keyboard-is-open'); });
            // set status bar as special color when there is no internet
            _this.setStatusBar();
            _this.network.onDisconnect().subscribe(function () { return _this.setStatusBar(); });
            _this.network.onConnect().subscribe(function () {
                _this.setStatusBar();
                _this.auth.isLoggedIn();
            });
            _this.splashScreen.hide();
        });
        // navigation guard, will navigate accordingly when user is logged out
        this.auth.notifier.distinctUntilChanged().subscribe(function (status) {
            if (status === true) {
                setTimeout(function () { return _this.goHomePage(); });
            }
            else if (status === false) {
                setTimeout(function () { return _this.goLoginPage(); });
            }
        });
        if (this.platform.is('ios')) {
            this.platform.resume.subscribe(function () { return _this.auth.isLoggedIn(); });
        }
    };
    MyApp.prototype.btnOpenPage = function (page) {
        this.goPage(page.name);
    };
    MyApp.prototype.btnMainPage = function () {
        this.goHomePage();
    };
    MyApp.prototype.setStatusBar = function () {
        if (this.network.type === 'none') {
            this.statusBar.backgroundColorByName('red');
        }
        else {
            this.statusBar.backgroundColorByName('black');
        }
    };
    MyApp = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Component"])({template:/*ion-inline-start:"G:\GLS\TMS SC\New folder\driver-v2\src\app\app.html"*/'<ion-menu [id]="allJobsMenuId" side="right" persistent="true" [content]="content">\n\n\n\n    <ion-header>\n\n        <ion-toolbar>\n\n            <ion-title>Menu</ion-title>\n\n            <ion-buttons right>\n\n                <button ion-button [menuClose]="allJobsMenuId" clear>\n\n                    <ion-icon name="close"></ion-icon>\n\n                </button>\n\n            </ion-buttons>\n\n        </ion-toolbar>\n\n    </ion-header>\n\n\n\n    <ion-content>\n\n        <ion-list>\n\n            <button ion-item detail-none *ngFor="let page of allJobsMenuPages" (tap)="btnOpenPage(page)">\n\n                <ion-icon item-left [name]="page.icon"></ion-icon>\n\n                {{page.title}}\n\n            </button>\n\n        </ion-list>\n\n    </ion-content>\n\n\n\n</ion-menu>\n\n\n\n<ion-nav #content></ion-nav>\n\n'/*ion-inline-end:"G:\GLS\TMS SC\New folder\driver-v2\src\app\app.html"*/,
        }),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_2_ionic_angular__["b" /* App */],
            __WEBPACK_IMPORTED_MODULE_9__providers_user_auth__["a" /* AuthProvider */],
            __WEBPACK_IMPORTED_MODULE_12__providers_user_user_driver__["a" /* UserDriverProvider */],
            __WEBPACK_IMPORTED_MODULE_3__ionic_native_keyboard__["a" /* Keyboard */],
            __WEBPACK_IMPORTED_MODULE_2_ionic_angular__["j" /* MenuController */],
            __WEBPACK_IMPORTED_MODULE_10__providers_driver_rest_native_http__["a" /* NativeHTTP */],
            __WEBPACK_IMPORTED_MODULE_6__ionic_native_network__["a" /* Network */],
            __WEBPACK_IMPORTED_MODULE_2_ionic_angular__["o" /* Platform */],
            __WEBPACK_IMPORTED_MODULE_4__ionic_native_status_bar__["a" /* StatusBar */],
            __WEBPACK_IMPORTED_MODULE_11__providers_storage_storage__["a" /* StorageProvider */],
            __WEBPACK_IMPORTED_MODULE_5__ionic_native_splash_screen__["a" /* SplashScreen */],
            __WEBPACK_IMPORTED_MODULE_1__ngx_translate_core__["c" /* TranslateService */]])
    ], MyApp);
    return MyApp;
}(__WEBPACK_IMPORTED_MODULE_13__providers_navigation_navigation__["a" /* NavigationProvider */]));

//# sourceMappingURL=app.component.js.map

/***/ }),

/***/ 111:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return NotificationProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__ionic_native_local_notifications__ = __webpack_require__(801);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_lodash_es__ = __webpack_require__(41);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};




var NotificationProvider = /** @class */ (function () {
    function NotificationProvider(toastCtrl, localNotifications) {
        this.toastCtrl = toastCtrl;
        this.localNotifications = localNotifications;
        this.maxCharacters = 254;
        this.toastOptions = {
            showCloseButton: true,
            position: 'top',
            duration: 3000,
        };
    }
    /**
     * Show toast notification for errors
     *
     * @param {string|Error} msg  Error message
     * @param {string|Error} serverError  Error message from server
     * @returns {Promise<Toast>}
     */
    NotificationProvider.prototype.error = function (msg, serverError) {
        console.log('[TOAST] Error:', msg, serverError);
        var message = Object(__WEBPACK_IMPORTED_MODULE_3_lodash_es__["j" /* toString */])(msg);
        // show string header only if the header does not contain text 'Error' (aesthetic purpose)
        if (!Object(__WEBPACK_IMPORTED_MODULE_3_lodash_es__["d" /* includes */])(message, 'Error')) {
            message = "Error: " + message;
        }
        // append server error
        if (serverError !== undefined) {
            message += '\n\nServer Error: ';
            if (serverError instanceof Error) {
                message += serverError.toString();
            }
            else {
                message += JSON.stringify(serverError);
            }
        }
        return this.show({ message: message, duration: (this.toastOptions.duration + 3000) });
    };
    /**
     * Show toast notification for info / misc
     *
     * @param {string} msg  Message to display
     * @returns {Promise<Toast>}
     */
    NotificationProvider.prototype.info = function (msg) {
        return this.show({ message: JSON.stringify(msg) });
    };
    /**
     * Show toast notification for success messages
     *
     * @param {string} msg  Success message
     * @returns {Promise<Toast>}
     */
    NotificationProvider.prototype.success = function (msg) {
        console.log('[TOAST] Success:', msg);
        return this.show({ message: "Success: " + msg });
    };
    /**
     * Show local notification that will appear in notification drawer
     *
     * @param {string} msg  Message to display
     */
    NotificationProvider.prototype.local = function (msg) {
        this.localNotifications.schedule({
            title: 'Logistics',
            text: msg,
            priority: 2,
            launch: true,
            // Android only
            clock: true,
            lockscreen: true,
            smallIcon: 'res://logo',
            color: '#1f7bb6',
        });
    };
    /**
     * Show toast notification
     *
     * @private
     * @param {ToastOptions} config  Custom config for each toast notification. Overrides default options
     * @returns {Promise<Toast>}
     */
    NotificationProvider.prototype.show = function (config) {
        // reduce the length of message if necessary to prevent toast taking up entire page space
        config.message = Object(__WEBPACK_IMPORTED_MODULE_3_lodash_es__["l" /* trim */])(config.message);
        if (config.message) {
            var truncatedMessage = config.message.substring(0, this.maxCharacters);
            truncatedMessage += (truncatedMessage === config.message) ? '' : '...'; // add ellipse if text was truncated
            config.message = truncatedMessage;
        }
        return this.toastCtrl.create(Object.assign({}, this.toastOptions, config)).present();
    };
    NotificationProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_1_ionic_angular__["q" /* ToastController */],
            __WEBPACK_IMPORTED_MODULE_2__ionic_native_local_notifications__["a" /* LocalNotifications */]])
    ], NotificationProvider);
    return NotificationProvider;
}());

//# sourceMappingURL=notification.js.map

/***/ }),

/***/ 112:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AuthApi; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return JobsApi; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return ItemApi; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "f", function() { return VehicleApi; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "e", function() { return MiscApi; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "d", function() { return MailApi; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__native_http__ = __webpack_require__(521);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__classes_job__ = __webpack_require__(136);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__classes_item__ = __webpack_require__(1065);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__user_auth_response__ = __webpack_require__(1066);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};






var CustomErrorHandler = /** @class */ (function () {
    function CustomErrorHandler() {
    }
    CustomErrorHandler.catch = function (err) {
        if (err.status === 0) {
            throw new Error("Invalid URL. Error: " + err.error);
        }
        else if (err.status === -1 && err.error) {
            throw err.error.split('Exception: ').pop();
        }
        else {
            throw err.error;
        }
    };
    return CustomErrorHandler;
}());
var AuthApi = /** @class */ (function () {
    function AuthApi(http) {
        this.http = http;
    }
    AuthApi.prototype.isLoggedIn = function () {
        return this.http.get('web/auth/v2/isLoggedIn')
            .then(function (result) { return new __WEBPACK_IMPORTED_MODULE_5__user_auth_response__["a" /* AuthResponse */](result); })
            .catch(CustomErrorHandler.catch);
    };
    AuthApi.prototype.resetPassword = function (data) {
        if (data === void 0) { data = {}; }
        return this.http.put('api/user/v2/password', data)
            .catch(CustomErrorHandler.catch);
    };
    AuthApi.prototype.login = function (data) {
        if (data === void 0) { data = {}; }
        return this.http.post('api/auth/v2/login', data)
            .then(function (result) { return new __WEBPACK_IMPORTED_MODULE_5__user_auth_response__["a" /* AuthResponse */](result); })
            .catch(function (err) {
            var msg = err.error;
            if (err.status === 401) {
                msg = 'Incorrect username or password.';
            }
            else if (err.status === 0 || err.status === 404) {
                msg = 'Please check that the server URL is valid.';
            }
            else if (err.status === -1 && err.error) {
                msg = "Unable to log in. " + err.error.split('Exception: ').pop();
            }
            else if (typeof msg !== 'string') {
                msg = "Unable to log in. " + JSON.stringify(msg);
            }
            throw msg;
        });
    };
    AuthApi.prototype.logout = function () {
        return this.http.post('api/auth/v2/logout', {})
            .catch(CustomErrorHandler.catch);
    };
    AuthApi = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_2__native_http__["a" /* NativeHTTP */]])
    ], AuthApi);
    return AuthApi;
}());

var JobsApi = /** @class */ (function () {
    function JobsApi(http) {
        this.http = http;
    }
    JobsApi.prototype.get = function (params) {
        if (params === void 0) { params = {}; }
        return this.http.get('web/data/v2.1/job', params)
            .then(function (result) { return Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(result, function (job) { return new __WEBPACK_IMPORTED_MODULE_3__classes_job__["b" /* Job */](job); }); })
            .catch(CustomErrorHandler.catch);
    };
    JobsApi.prototype.attempt = function (body) {
        // @see https://github.com/silkimen/cordova-plugin-advanced-http/issues/63
        // @see https://github.com/silkimen/cordova-plugin-advanced-http/issues/101
        return this.http.put("api/data/v2.1/job/" + body.jobId + "/attemptB64", body.withBase64())
            .catch(CustomErrorHandler.catch);
    };
    JobsApi.prototype.sync = function (body) {
        if (body === void 0) { body = []; }
        // @see https://github.com/silkimen/cordova-plugin-advanced-http/issues/63
        // @see https://github.com/silkimen/cordova-plugin-advanced-http/issues/101
        return this.http.post("api/data/v2.1/job/syncB64", Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(body, function (job) { return job.withBase64(); }))
            .catch(CustomErrorHandler.catch);
    };
    JobsApi.prototype.getPodPhotos = function (jobId) {
        return this.http.get("web/data/v2.1/pod/" + jobId)
            .catch(CustomErrorHandler.catch);
    };
    JobsApi.prototype.getNotePhotos = function (jobId) {
        return this.http.get("web/data/v2.1/note/" + jobId)
            .catch(CustomErrorHandler.catch);
    };
    JobsApi = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_2__native_http__["a" /* NativeHTTP */]])
    ], JobsApi);
    return JobsApi;
}());

var ItemApi = /** @class */ (function () {
    function ItemApi(http) {
        this.http = http;
    }
    ItemApi.prototype.get = function (itemId) {
        return this.http.get("web/data/v2.1/item/" + itemId)
            .then(function (result) { return new __WEBPACK_IMPORTED_MODULE_4__classes_item__["a" /* Item */](result); })
            .catch(CustomErrorHandler.catch);
    };
    ItemApi = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_2__native_http__["a" /* NativeHTTP */]])
    ], ItemApi);
    return ItemApi;
}());

var VehicleApi = /** @class */ (function () {
    function VehicleApi(http) {
        this.http = http;
    }
    VehicleApi.prototype.update = function (vehicleId, data) {
        return this.http.put("api/data/v2.1/vehicle/" + vehicleId, { newValues: data })
            .catch(CustomErrorHandler.catch);
    };
    VehicleApi = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_2__native_http__["a" /* NativeHTTP */]])
    ], VehicleApi);
    return VehicleApi;
}());

var MiscApi = /** @class */ (function () {
    function MiscApi(http) {
        this.http = http;
    }
    MiscApi.prototype.getLatestAppVersion = function () {
        return this.http.get('web/data/v2.1/misc/app/version', {}, { 'Content-Type': 'application/text' })
            .catch(CustomErrorHandler.catch);
    };
    MiscApi = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_2__native_http__["a" /* NativeHTTP */]])
    ], MiscApi);
    return MiscApi;
}());

var MailApi = /** @class */ (function () {
    function MailApi(http) {
        this.http = http;
    }
    MailApi.prototype.send = function (data) {
        return this.http.post('api/message/v2', data)
            .catch(CustomErrorHandler.catch);
    };
    MailApi = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_2__native_http__["a" /* NativeHTTP */]])
    ], MailApi);
    return MailApi;
}());

//# sourceMappingURL=driver-rest.js.map

/***/ }),

/***/ 136:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return JobStatus; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "d", function() { return JobType; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return Job; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AttemptedJob; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_moment__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_moment___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_moment__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__note__ = __webpack_require__(800);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */



/**
 * All possible job status
 *
 * @enum {number}
 */
var JobStatus;
(function (JobStatus) {
    JobStatus[JobStatus["Pending"] = 1] = "Pending";
    JobStatus[JobStatus["Late"] = 2] = "Late";
    JobStatus[JobStatus["Ontime"] = 3] = "Ontime";
    JobStatus[JobStatus["Unsuccessful"] = 4] = "Unsuccessful";
    JobStatus[JobStatus["ExpectToBeLate"] = 5] = "ExpectToBeLate";
})(JobStatus || (JobStatus = {}));
/**
 * All possible job types
 *
 * @enum {string}
 */
var JobType;
(function (JobType) {
    JobType["Pickup"] = "PICKUP";
    JobType["Delivery"] = "DELIVERY";
})(JobType || (JobType = {}));
/**
 * Represents a job object that is returned from the server. Multiple
 * jobs can belong to the same order, indicated by `DeliveryMasterId`.
 *
 * @class Job
 */
var Job = /** @class */ (function () {
    function Job(init) {
        Object.assign(this, init);
    }
    Object.defineProperty(Job.prototype, "Id", {
        get: function () { return this._Id; },
        set: function (id) { this._Id = id; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "DeliveryMasterId", {
        get: function () { return this._DeliveryMasterId; },
        set: function (id) { this._DeliveryMasterId = id; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "JobType", {
        get: function () { return this._JobType; },
        set: function (jobtype) { this._JobType = jobtype; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "Status", {
        get: function () { return this._Status; },
        set: function (status) { this._Status = status; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "Address", {
        get: function () { return this._Address; },
        set: function (addr) { this._Address = addr; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "Postal", {
        get: function () { return this._Postal; },
        set: function (postal) { this._Postal = postal; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "Lat", {
        get: function () { return this._Lat; },
        set: function (lat) { this._Lat = lat; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "Lng", {
        get: function () { return this._Lng; },
        set: function (lng) { this._Lng = lng; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "ContactName", {
        get: function () { return this._ContactName; },
        set: function (name) { this._ContactName = name; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "ContactPhone", {
        get: function () { return this._ContactPhone; },
        set: function (phone) { this._ContactPhone = phone; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "JobSequence", {
        get: function () { return this._JobSequence; },
        set: function (seq) { this._JobSequence = seq; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "EngineRouteSeqNum", {
        get: function () { return this._EngineRouteSeqNum; },
        set: function (num) { this._EngineRouteSeqNum = num; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "StartTimeWindow", {
        get: function () { return this._StartTimeWindow; },
        set: function (date) { this._StartTimeWindow = date ? __WEBPACK_IMPORTED_MODULE_0_moment__(date).toDate() : undefined; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "EndTimeWindow", {
        get: function () { return this._EndTimeWindow; },
        set: function (date) { this._EndTimeWindow = date ? __WEBPACK_IMPORTED_MODULE_0_moment__(date).toDate() : undefined; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "ActualDeliveryTime", {
        get: function () { return this._ActualDeliveryTime; },
        set: function (date) { this._ActualDeliveryTime = date ? __WEBPACK_IMPORTED_MODULE_0_moment__(date).toDate() : undefined; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "NoteFromPlanner", {
        get: function () { return this._NoteFromPlanner; },
        set: function (notes) { this._NoteFromPlanner = this.initNotes(notes); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "NoteFromDriver", {
        get: function () { return this._NoteFromDriver; },
        set: function (notes) { this._NoteFromDriver = this.initNotes(notes); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "DeliveryItems", {
        get: function () { return this._DeliveryItems; },
        set: function (items) { this._DeliveryItems = items; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "VerificationCode", {
        get: function () { return this._VerificationCode; },
        set: function (code) { this._VerificationCode = this.initVerificationCode(code); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Job.prototype, "UserGroup", {
        get: function () { return this._UserGroup; },
        set: function (usergroup) { this._UserGroup = usergroup; },
        enumerable: true,
        configurable: true
    });
    /**
     * Estimates job status based on local time (i.e. not server time)
     *
     * @param {boolean} [delivered=false]  Set true if job is successful, regardless complete or incomplete items count
     * @param {string} attemptedTime  Time of attempt, regardless successful or not
     * @returns {JobStatus}
     */
    Job.prototype.estimateStatus = function (delivered, attemptedTime) {
        if (delivered === void 0) { delivered = false; }
        if (delivered === false) {
            return JobStatus.Unsuccessful;
        }
        else if (__WEBPACK_IMPORTED_MODULE_0_moment__(this.EndTimeWindow).isAfter(__WEBPACK_IMPORTED_MODULE_0_moment__(attemptedTime))) {
            return JobStatus.Ontime;
        }
        else {
            return JobStatus.Late;
        }
    };
    /**
     * Returns an object without private properties
     *
     * @returns {*}  JSON object
     */
    Job.prototype.toJSON = function () {
        return {
            Id: this._Id,
            DeliveryMasterId: this._DeliveryMasterId,
            JobType: this._JobType,
            Status: this._Status,
            Address: this._Address,
            Postal: this._Postal,
            Lat: this._Lat,
            Lng: this._Lng,
            ContactName: this._ContactName,
            ContactPhone: this._ContactPhone,
            JobSequence: this._JobSequence,
            StartTimeWindow: this._StartTimeWindow,
            EndTimeWindow: this._EndTimeWindow,
            NoteFromPlanner: JSON.stringify(Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(this._NoteFromPlanner, function (note) { return note.toJSON(); })),
            NoteFromDriver: JSON.stringify(Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(this._NoteFromDriver, function (note) { return note.toJSON(); })),
            UserGroup: this._UserGroup,
        };
    };
    /**
     * Whether job is a pickup
     *
     * @returns {boolean}  True if job is a pickup
     */
    Job.prototype.isPickup = function () {
        return this.JobType === JobType.Pickup;
    };
    /**
     * Whether job is a delivery
     *
     * @returns {boolean}  True if job is a delivery
     */
    Job.prototype.isDelivery = function () {
        return this.JobType === JobType.Delivery;
    };
    /**
     * Whether job is not done
     *
     * @returns {boolean}  True if job is not done
     */
    Job.prototype.isPending = function () {
        return this.Status === JobStatus.Pending || this.Status === JobStatus.ExpectToBeLate;
    };
    /**
     * Whether job is unsuccessful; job was attempted, but items were not delivered
     *
     * @returns {boolean}  True if job is unsuccessful
     */
    Job.prototype.isUnsuccessful = function () {
        return this.Status === JobStatus.Unsuccessful;
    };
    /**
     * Whether job is done
     *
     * @returns {boolean}  True if job is done
     */
    Job.prototype.isCompleted = function () {
        return !this.isPending() && !this.isUnsuccessful();
    };
    /**
     * Whether job requires verification
     *
     * @returns {boolean}  True if job needs verification before allow attempt
     */
    Job.prototype.hasVerificationCode = function () {
        return !!(this._VerificationCode);
    };
    /**
     * Verifies input against verification code (case-insensitive)
     *
     * @param {string} code  Code input from driver
     * @returns {boolean}  True if code input is correct
     */
    Job.prototype.verifyCode = function (code) {
        return (Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["k" /* toUpper */])(Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["l" /* trim */])(code)) === Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["k" /* toUpper */])(Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["l" /* trim */])(this._VerificationCode.Code)));
    };
    /**
     * Maps JSON from server to `Note` objects
     * As accessors cannot be of different types, this function acts like a middleman
     * @see {@link https://github.com/Microsoft/TypeScript/issues/2521}
     *
     * @private
     * @param {any[]} [notes=[]]  Note columns from server
     * @returns {Note[]}
     */
    Job.prototype.initNotes = function (notes) {
        if (notes === void 0) { notes = []; }
        notes = Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["f" /* isNil */])(notes) ? [] : notes;
        return Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(notes, function (note) { return new __WEBPACK_IMPORTED_MODULE_2__note__["b" /* Note */](note); });
    };
    /**
     * Maps response from server to `IVerificationCode` object
     * As accessors cannot be of different types, this function acts like a middleman
     * @see {@link https://github.com/Microsoft/TypeScript/issues/2521}
     *
     * @private
     * @param {(string | IVerificationCode)} code  VerificationCode column from server
     * @returns {IVerificationCode}
     */
    Job.prototype.initVerificationCode = function (code) {
        return (code && typeof code === 'string') ? { Code: code } : code;
    };
    return Job;
}());

/**
 * Represents an attempted job. Used to send to the server to
 * indicate job attempt, regardless success or failure
 *
 * @class AttemptedJob
 */
var AttemptedJob = /** @class */ (function () {
    function AttemptedJob(init) {
        var _this = this;
        Object.assign(this, init);
        // get blobs of all images
        this.signature = this.b64ToBlob(this.signatureB64);
        this.photo = this.b64ToBlob(this.photoB64);
        this.notePhotos = Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(this.notePhotosB64, function (photo) { return _this.b64ToBlob(photo); });
        // initialise notes as Note instances
        if (init.note !== undefined && init.note.length) {
            this.note = Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(init.note, function (note) { return new __WEBPACK_IMPORTED_MODULE_2__note__["b" /* Note */](note); });
        }
    }
    /**
     * Returns full job details with file variables in base64.
     * TODO: To be removed once binary data can be sent to server
     *
     * @returns {*}  JSON object
     */
    AttemptedJob.prototype.withBase64 = function () {
        var _this = this;
        return Object.assign({
            notePhotos: Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(this.notePhotosB64, function (photo) { return _this.trimB64Uri(photo); }),
            signature: this.trimB64Uri(this.signatureB64),
            photo: this.trimB64Uri(this.photoB64),
        }, this.getJobDetails());
    };
    /**
     * Returns full job details with file variables in buffer
     *
     * @returns {*}  JSON object
     */
    AttemptedJob.prototype.withBuffer = function () {
        return Object.assign({
            notePhotos: this.notePhotos,
            signature: this.signature,
            photo: this.photo,
        }, this.getJobDetails());
    };
    /**
     * Returns job details without file variables
     *
     * @returns {*}  JSON object
     */
    AttemptedJob.prototype.getJobDetails = function () {
        return {
            jobId: this.jobId,
            delivered: this.delivered,
            note: Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["g" /* map */])(this.note, function (note) { return note.toJSON(); }),
            items: this.items,
            attemptedByDriver: this.attemptedByDriver,
            attemptedByVehicle: this.attemptedByVehicle,
            deliveryTime: this.deliveryTime,
        };
    };
    /**
     * Remove URI portion of the base64 string
     *
     * @private
     * @param {string} b64Data  Base64 string
     * @returns {string}  Base64 string without URI information
     * @example trimB64Uri(data:image/png;charset=utf-8;base64,/9j/4) // returns `/9j/4`
     */
    AttemptedJob.prototype.trimB64Uri = function (b64Data) {
        b64Data = Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["l" /* trim */])(b64Data);
        if (!b64Data) { // exit function if data is empty or missing
            return undefined;
        }
        else if (b64Data.indexOf(';base64,')) { // remove mimetype if any
            return b64Data.split(';base64,').pop();
        }
    };
    /**
     * Converts base64 strings to blob object
     *
     * @private
     * @param {string} b64Data  Base64 string
     * @param {string} [contentType='image/jpeg']  Blob type
     * @returns {Blob}
     * @see {@link https://stackoverflow.com/a/16245768/804702}
     */
    AttemptedJob.prototype.b64ToBlob = function (b64Data, contentType) {
        if (contentType === void 0) { contentType = 'image/jpeg'; }
        var sliceSize = 512;
        b64Data = this.trimB64Uri(b64Data);
        if (!b64Data) { // exit function if data is empty or missing
            return undefined;
        }
        var byteCharacters = atob(b64Data);
        var byteArrays = [];
        for (var offset = 0; offset < byteCharacters.length; offset += sliceSize) {
            var slice = byteCharacters.slice(offset, offset + sliceSize);
            var byteNumbers = new Array(slice.length);
            for (var i = 0; i < slice.length; i++) {
                byteNumbers[i] = slice.charCodeAt(i);
            }
            var byteArray = new Uint8Array(byteNumbers);
            byteArrays.push(byteArray);
        }
        return new Blob(byteArrays, { type: contentType });
    };
    return AttemptedJob;
}());

//# sourceMappingURL=job.js.map

/***/ }),

/***/ 137:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return UserDriverProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_moment__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_moment___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_moment__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__globals__ = __webpack_require__(40);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__classes_job__ = __webpack_require__(136);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__geolocation_geolocation__ = __webpack_require__(219);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__loading_loading__ = __webpack_require__(544);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__notification_notification__ = __webpack_require__(111);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__storage_storage__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__ = __webpack_require__(520);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__driver_rest_driver_rest__ = __webpack_require__(112);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};













var UserDriverProvider = /** @class */ (function () {
    function UserDriverProvider(alertCtrl, geolocation, jobsApi, loading, notify, storage, vehicleApi, websocket) {
        this.alertCtrl = alertCtrl;
        this.geolocation = geolocation;
        this.jobsApi = jobsApi;
        this.loading = loading;
        this.notify = notify;
        this.storage = storage;
        this.vehicleApi = vehicleApi;
        this.websocket = websocket;
        this.jobs = [];
        this.isSyncing = false; // indicates whether the device is currently syncing to server
        this.DATE_FORMAT = 'DD/MM/YYYY';
    }
    /**
     * Initialise driver. This function should only be called once
     *
     * @param {AuthResponse} userDetails  User object from server
     * @returns {Promise<void>}
     */
    UserDriverProvider.prototype.initDriver = function (userDetails) {
        console.log('[INIT] Initialising driver');
        this.setDriver(userDetails);
        this.initWebsocketEvents();
        this.geolocation.start(this.vehicleId, this.vehiclePlateNumber, this.vehicleUserGroup);
    };
    /**
     * Set user details based on settings from server
     *
     * @private
     * @param {AuthResponse} userDetails  User object from server
     */
    UserDriverProvider.prototype.setDriver = function (userDetails) {
        console.log('[INIT] Setting driver variables and uploading offline jobs');
        this.name = userDetails.fullname;
        this.vehicleId = userDetails.vehicleId;
        this.vehiclePlateNumber = userDetails.vehiclePlateNumber;
        this.vehicleUserGroup = userDetails.vehicleUserGroup;
        // save these parameters in case the geolocation stated failed
        // so that on the app permission page, restart the geolocation tracking
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].user.vehicleId = this.vehicleId;
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].user.vehiclePlateNumber = this.vehiclePlateNumber;
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].user.vehicleUserGroup = this.vehicleUserGroup;
        this.configureFeatures(userDetails);
        // even though uploadOfflineJobs also calls getJobsFromServer, but there is a
        // chance where it doesn't call getJobsFromServer, so it's better to upload
        // offline jobs only after getting full job list from server
        return this.getJobsFromServer().then(this.uploadOfflineJobs).catch(function () { });
    };
    /**
     * Reset driver-specific variables
     */
    UserDriverProvider.prototype.resetDriver = function () {
        this.name = undefined;
        this.vehicleId = undefined;
        this.vehiclePlateNumber = undefined;
        this.vehicleUserGroup = undefined;
        this.jobs = [];
        this.currentJob = undefined;
        this.geolocation.stop();
    };
    /**
     * Function to call at every job attempt. Process is as such:
     *  1. Attempted job is stored on the device storage.
     *  2. If save is successful, return. Otherwise, continue.
     *  3. Send request to API
     *  4. If API request fails, return error. Otherwise, continue.
     *
     * @param {AttemptedJob} attemptedJob  Job that was attempted
     * @returns {Promise<void>}
     */
    UserDriverProvider.prototype.jobAttempt = function (attemptedJob) {
        var _this = this;
        // store in local database
        var timeNow = __WEBPACK_IMPORTED_MODULE_3_moment__();
        return this.uploadOfflineJobs().catch(function (err) {
            console.log('[ATTEMPT] Ignoring error from upload offline jobs before attempt', err);
        }).then(function () {
            // send request to server
            var attemptApi = _this.jobsApi.attempt(attemptedJob).then(function (job) { return _this.onUpdateJob(job); });
            if (__WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].features.enableOfflineSync === false) { // immediately return server response if feature is not enabled
                return attemptApi;
            }
            else {
                console.log("[ATTEMPT] Saving job into database " + attemptedJob.jobId);
                return _this.storage.insertJob({
                    jobId: attemptedJob.jobId,
                    attemptedByDriver: _this.name,
                    attemptedByVehicle: _this.vehiclePlateNumber,
                    delivered: attemptedJob.delivered,
                    deliveryTime: timeNow.toISOString(),
                    signatureB64: attemptedJob.signatureB64,
                    photoB64: attemptedJob.photoB64,
                    notePhotosB64: attemptedJob.notePhotosB64,
                    note: attemptedJob.note,
                    items: attemptedJob.items,
                }).then(function (insertedId) {
                    // assume job is saved successfully and update job list on local device
                    var actualJob = _this.jobs.find(function (job) { return (job.Id === attemptedJob.jobId); });
                    _this.onUpdateJob({
                        Id: attemptedJob.jobId,
                        Status: actualJob.estimateStatus(attemptedJob.delivered, timeNow.toISOString()),
                        ActualDeliveryTime: timeNow.toDate(),
                        NoteFromDriver: attemptedJob.note,
                    });
                    // allow user to continue without waiting for request to complete
                    attemptApi
                        .then(function () { return _this.storage.deleteJob(insertedId); })
                        .catch(function (e) { return console.log('[ATTEMPT] Failed to send request to server', e); });
                }).catch(function () {
                    // since job cannot be saved, return attemptJob promise
                    return attemptApi;
                });
            }
        });
    };
    /**
     * Get list of all attempted jobs in the storage
     *
     * @returns {Promise<AttemptedJob[]>}
     */
    UserDriverProvider.prototype.getOfflineJobs = function () {
        if (__WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].features.enableOfflineSync === false) {
            return Promise.reject('Offline sync feature is not enabled.');
        }
        return this.storage.getAllJobs().then(function (results) { return results.map(function (job) { return new __WEBPACK_IMPORTED_MODULE_5__classes_job__["a" /* AttemptedJob */](job); }); });
    };
    /**
     * Upload all attempted jobs in the storage to the server
     *
     * @returns {Promise<void>}
     */
    UserDriverProvider.prototype.uploadOfflineJobs = function () {
        var _this = this;
        if (__WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].features.enableOfflineSync === false) {
            return Promise.reject('Offline sync feature is not enabled.');
        }
        console.log('Uploading offline jobs');
        if (this.isSyncing === true) {
            return this.notify.error('Currently uploading data to server. Please try again 5 minutes later.').then(function () { });
        }
        this.isSyncing = true;
        return this.getOfflineJobs().then(function (jobs) {
            _this.isSyncing = false;
            if (jobs.length > 0) {
                return _this.jobsApi.sync(jobs)
                    .then(function () { return _this.getJobsFromServer(); })
                    .then(function () { _this.storage.deleteAllJobs(); });
            }
            else {
                return Promise.resolve();
            }
        }).catch(function (err) {
            _this.isSyncing = false;
            throw err;
        });
    };
    /**
     * Find the next pending job in the job list
     */
    UserDriverProvider.prototype.updateCurrentJob = function () {
        this.currentJob = this.jobs.find(function (job) { return job.isPending(); });
    };
    /**
     * Change plate number of the vehicle that is assigned to the driver
     *
     * @param {string} newPlateNumber  New plate number
     * @returns {Promise<string>}  Returns error (if any)
     */
    UserDriverProvider.prototype.updatePlateNumber = function (newPlateNumber) {
        return this.vehicleApi.update(this.vehicleId, { PlateNumber: newPlateNumber });
    };
    /**
     * Check whether another job needs to be done first.
     * Criteria:
     *  1. `job` is a delivery of a shipment
     *  2. The shipment has a pickup that is not done
     *
     * @param {Job} job
     * @returns {boolean}  True if another job that needs to be done first has not complete
     */
    UserDriverProvider.prototype.isPreviousJobComplete = function (job) {
        if (job.isPickup() === true) {
            return true; // if job is pickup, it doesn't matter what the previous jobs statuses are
        }
        else {
            return !this.jobs.find(function (otherJob) {
                return otherJob.DeliveryMasterId === job.DeliveryMasterId &&
                    otherJob.Id !== job.Id &&
                    otherJob.isPickup() &&
                    otherJob.JobSequence <= job.JobSequence &&
                    !otherJob.isCompleted();
            });
        }
    };
    /**
     * Get list of jobs from the server
     *
     * @private
     * @param {string} [loaderMsg='Updating jobs']  Custom loader message
     * @returns {Promise<void>}
     */
    UserDriverProvider.prototype.getJobsFromServer = function (loaderMsg) {
        var _this = this;
        if (loaderMsg === void 0) { loaderMsg = 'Updating jobs'; }
        var loader = this.loading.show(loaderMsg);
        var today = __WEBPACK_IMPORTED_MODULE_3_moment__().toISOString();
        var showNotification = false;
        var previousJobInfo = __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].user.previousJobsInfo;
        var _a = previousJobInfo ? previousJobInfo.split(',') : [], _b = _a[0], joblength = _b === void 0 ? '' : _b, _c = _a[1], jobdate = _c === void 0 ? '' : _c;
        return this.jobsApi.get({ date: today }).then(function (jobs) {
            if (jobs.length !== Number(joblength) && (__WEBPACK_IMPORTED_MODULE_3_moment__(jobdate, _this.DATE_FORMAT).isSame(__WEBPACK_IMPORTED_MODULE_3_moment__(), 'day'))) {
                // show notification only if job count is different from the last recent load and date is today
                showNotification = true;
            }
            else if (_this.jobs.length > 0) {
                // check if need to show notification by checking the jobs in new list exists in local variable
                for (var i = 0; i < jobs.length; i++) {
                    var jobExists = Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["b" /* find */])(_this.jobs, { Id: jobs[i].Id });
                    if (!jobExists) {
                        showNotification = true; // major job change
                        break;
                    }
                }
            }
            _this.jobs = jobs.sort(function (a, b) { return (a.EngineRouteSeqNum < b.EngineRouteSeqNum) ? -1 : 1; });
            _this.updateCurrentJob();
            loader.dismiss();
            if (showNotification) {
                var notificationText = 'Updated jobs list for today';
                _this.notify.local(notificationText);
                _this.notify.info(notificationText);
            }
            __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].user.previousJobsInfo = jobs.length.toString() + "," + __WEBPACK_IMPORTED_MODULE_3_moment__().format(_this.DATE_FORMAT);
            _this.storage.setKeyValue(__WEBPACK_IMPORTED_MODULE_4__globals__["d" /* StorageKey */].PreviousJobsInfo, __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].user.previousJobsInfo);
        }).catch(function (err) {
            loader.dismiss();
            var alert = _this.alertCtrl
                .create({
                title: 'Error',
                subTitle: "Unable to get updated job list.<br>Please log out and log in again. Server Error: " + err,
                buttons: ['OK'],
            });
            alert.present();
            throw err;
        });
    };
    /**
     * Override global settings according to server provided settings
     *
     * @private
     * @param {AuthResponse} serverSettings  Settings from server
     */
    UserDriverProvider.prototype.configureFeatures = function (serverSettings) {
        serverSettings.statusLabels.forEach(function (status) {
            var dictionary = __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].jobStatusPair[status.value];
            if (dictionary) {
                dictionary.title = Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["a" /* capitalize */])(status.label);
            }
        });
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].setting.note.maxNumPhoto = serverSettings.noteOptions.photo.maxCount;
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].setting.note.optionRequired = serverSettings.noteOptions.option.required;
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].setting.note.options = serverSettings.noteOptions.option.list;
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].setting.pod.photoRequired = serverSettings.podOptions.photo.required;
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].setting.item.defaultInput = (serverSettings.itemOptions.input.default === 'BARCODE') ? __WEBPACK_IMPORTED_MODULE_4__globals__["b" /* ItemInputMethod */].Barcode : __WEBPACK_IMPORTED_MODULE_4__globals__["b" /* ItemInputMethod */].Keyboard;
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].setting.item.allowSwitchInput = serverSettings.itemOptions.input.allowToggle;
        __WEBPACK_IMPORTED_MODULE_4__globals__["a" /* Globals */].setting.item.acceptedCodes = serverSettings.itemOptions.barcode.formats;
    };
    /**
     * Initialise all driver-related websocket message events
     *
     * @private
     */
    UserDriverProvider.prototype.initWebsocketEvents = function () {
        var _this = this;
        this.websocket.onJSON(__WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["a" /* WebsocketEvent */].Vehicle, function (msg) {
            if (msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Update || msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Create) {
                msg.data.forEach(function (vehicle) { return _this.onUpdateVehicle(vehicle); });
            }
        });
        this.websocket.onJSON(__WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["a" /* WebsocketEvent */].DeliveryPlan, function (msg) {
            if (msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Update || msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Create) {
                var todayPlanChanged = msg.data.indexOf(__WEBPACK_IMPORTED_MODULE_3_moment__().format('YYYY-MM-DD'));
                if (todayPlanChanged > -1) {
                    _this.getJobsFromServer();
                }
            }
        });
        this.websocket.onJSON(__WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["a" /* WebsocketEvent */].DeliveryMaster, function (msg) {
            if (msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Delete) {
                _this.onDeleteJob(msg.data);
            }
        });
        this.websocket.onJSON(__WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["a" /* WebsocketEvent */].DeliveryDetail, function (msg) {
            if (msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Update || msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Attempted) {
                msg.data.forEach(function (job) { return _this.onUpdateJob(job); });
            }
        });
        this.websocket.onJSON(__WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["a" /* WebsocketEvent */].DeliveryItem, function (msg) {
            if (msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Create) {
                var jobId = Number(msg.data[0].DeliveryDetailId);
                _this.onUpdateJob({
                    Id: jobId,
                    DeliveryItems: msg.data,
                });
            }
            else if (msg.purpose === __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["c" /* WebsocketPurpose */].Delete) {
                msg.data.forEach(function (deletedItems) {
                    var jobId = Number(deletedItems.DeliveryDetailId);
                    var oldItems = _this.jobs.find(function (job) { return job.Id === jobId; }).DeliveryItems;
                    _this.onUpdateJob({
                        Id: jobId,
                        DeliveryItems: oldItems.filter(function (item) { return deletedItems.Ids.indexOf(item.Id) < 0; }),
                    });
                });
            }
        });
    };
    /**
     * Websocket event: New vehicle is assigned.
     * Note: This event will not be called for the scenario when the originally
     * assigned vehicle is later assigned to another driver
     *
     * @private
     * @param {{ Id: string, PlateNumber: string }} newVehicle  Vehicle that is newly assigned
     */
    UserDriverProvider.prototype.onUpdateVehicle = function (newVehicle) {
        var oldVehicleId = this.vehicleId;
        this.vehicleId = newVehicle.Id;
        this.vehiclePlateNumber = newVehicle.PlateNumber;
        this.vehicleUserGroup = newVehicle.UserGroup;
        if (oldVehicleId !== this.vehicleId) {
            console.log("[WEBSOCKET] Changed vehicle assignment from " + oldVehicleId + " to " + this.vehicleId);
            this.getJobsFromServer('Updating jobs due to change of vehicle...');
        }
        // have to set these variables again
        this.geolocation.start(this.vehicleId, this.vehiclePlateNumber, this.vehicleUserGroup);
    };
    /**
     * Websocket event: Any job modifications, including DeliveryItem changes
     *
     * @private
     * @param {Job} newJob  New job details
     */
    UserDriverProvider.prototype.onUpdateJob = function (newJob) {
        newJob.Id = Number(newJob.Id); // ensure DeliveryDetail Id doesn't get overwritten with string
        var jobToUpdate = this.jobs.find(function (job) { return job.Id === newJob.Id; });
        Object.assign(jobToUpdate, newJob);
        // updated affected jobs (in case update job function is called when driver is offline)
        if (jobToUpdate.isUnsuccessful() === true && jobToUpdate.isPickup() === true) {
            this.jobs.forEach(function (job) {
                if (jobToUpdate.DeliveryMasterId === job.DeliveryMasterId &&
                    jobToUpdate.JobSequence <= job.JobSequence &&
                    job.isDelivery() && job.isPending()) {
                    job.Status = __WEBPACK_IMPORTED_MODULE_5__classes_job__["c" /* JobStatus */].Unsuccessful;
                }
            });
        }
        // don't show notifications for change verification code and update expected to be late status
        if (newJob.DeliveryMasterId) {
            // TODO: Show only one at any one time
            // this.notify.info(`Job ${newJob.DeliveryMasterId} (${newJob.JobType}) has been updated`);
        }
        // check if there is a need to update current job
        if (Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["e" /* isEqual */])(this.currentJob, jobToUpdate.Id) === false) {
            this.updateCurrentJob();
        }
    };
    /**
     * Websocket event: Delete existing job
     *
     * @private
     * @param {string[]} orderIds  List of DeliveryMasterId
     */
    UserDriverProvider.prototype.onDeleteJob = function (orderIds) {
        var _this = this;
        var shouldUpdateCurrentJob = false;
        Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["h" /* remove */])(this.jobs, function (job) {
            if (orderIds.indexOf(job.DeliveryMasterId) > -1) {
                _this.notify.info("Job " + job.DeliveryMasterId + " (" + job.JobType + ") has been removed.");
                // check if the current job was removed
                if (!shouldUpdateCurrentJob && orderIds.indexOf(_this.currentJob.DeliveryMasterId) > -1) {
                    shouldUpdateCurrentJob = true;
                }
                return true;
            }
        });
        if (shouldUpdateCurrentJob) {
            this.updateCurrentJob();
        }
    };
    UserDriverProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_1_ionic_angular__["a" /* AlertController */],
            __WEBPACK_IMPORTED_MODULE_6__geolocation_geolocation__["a" /* GeolocationProvider */],
            __WEBPACK_IMPORTED_MODULE_11__driver_rest_driver_rest__["c" /* JobsApi */],
            __WEBPACK_IMPORTED_MODULE_7__loading_loading__["a" /* LoadingProvider */],
            __WEBPACK_IMPORTED_MODULE_8__notification_notification__["a" /* NotificationProvider */],
            __WEBPACK_IMPORTED_MODULE_9__storage_storage__["a" /* StorageProvider */],
            __WEBPACK_IMPORTED_MODULE_11__driver_rest_driver_rest__["f" /* VehicleApi */],
            __WEBPACK_IMPORTED_MODULE_10__websocket_websocket__["b" /* WebsocketProvider */]])
    ], UserDriverProvider);
    return UserDriverProvider;
}());

//# sourceMappingURL=user-driver.js.map

/***/ }),

/***/ 138:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return StorageProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ionic_native_sqlite__ = __webpack_require__(803);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__globals__ = __webpack_require__(40);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__sql_table__ = __webpack_require__(1063);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};




var StorageProvider = /** @class */ (function () {
    function StorageProvider(sqlite) {
        this.sqlite = sqlite;
        this.databaseName = 'simtech.opms.lml';
    }
    /**
     * Establishes connection to the database and creates all tables
     *
     * @returns {Promise<void>}
     */
    StorageProvider.prototype.init = function () {
        var _this = this;
        return this.sqlite.create({
            name: this.databaseName,
            location: 'default',
        }).then(function (db) {
            _this.tableKeyVal = new __WEBPACK_IMPORTED_MODULE_3__sql_table__["b" /* KeyValueTable */](db);
            _this.tableJobs = new __WEBPACK_IMPORTED_MODULE_3__sql_table__["a" /* JobsTable */](db);
            return _this.createTables();
        }).then(function () {
            if (__WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].features.showChangeUrl) {
                return _this.getKeyValue(__WEBPACK_IMPORTED_MODULE_2__globals__["d" /* StorageKey */].Url).then(function (url) {
                    if (url !== undefined) {
                        __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].url = url;
                    }
                });
            }
            else {
                // overwrite existing database value because driver can no longer change url
                return _this.setKeyValue(__WEBPACK_IMPORTED_MODULE_2__globals__["d" /* StorageKey */].Url, __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].default.url).then(function () { });
            }
        }).then(function () {
            return _this.getKeyValue(__WEBPACK_IMPORTED_MODULE_2__globals__["d" /* StorageKey */].ApiToken).then(function (token) {
                if (token !== undefined) {
                    __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].user.token = token;
                }
            });
        }).then(function () {
            return _this.getKeyValue(__WEBPACK_IMPORTED_MODULE_2__globals__["d" /* StorageKey */].Username).then(function (username) {
                if (username !== undefined) {
                    __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].user.username = username;
                }
            });
        }).then(function () {
            return _this.getKeyValue(__WEBPACK_IMPORTED_MODULE_2__globals__["d" /* StorageKey */].PreviousJobsInfo).then(function (previousjobsinfo) {
                if (previousjobsinfo !== undefined) {
                    __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].user.previousJobsInfo = previousjobsinfo;
                }
            });
        }).catch(function () { }); // catch for web usage
    };
    /**
     * Insert a job into the `jobs` table
     *
     * @param {IJobsColumns} job  Job to insert
     * @returns {Promise<number>}  Row ID
     */
    StorageProvider.prototype.insertJob = function (job) {
        if (this.tableJobs === undefined) {
            return Promise.reject('Tables are not initialised');
        }
        return this.tableJobs.sqlInsert(job);
    };
    /**
     * Get all jobs from `jobs` table
     *
     * @returns {Promise<IJobsColumns[]>}
     */
    StorageProvider.prototype.getAllJobs = function () {
        var _this = this;
        if (this.tableJobs === undefined) {
            return Promise.reject('Tables are not initialised');
        }
        return this.tableJobs.sqlSelect().then(function (results) {
            return results.map(function (row) {
                // this parsing must be done manually since javascript has no context of what is object at runtime
                row.delivered = _this.toBool(row.delivered);
                row.notePhotosB64 = _this.toJSON(row.notePhotosB64);
                row.note = _this.toJSON(row.note);
                row.items = _this.toJSON(row.items);
                return row;
            });
        });
    };
    /**
     * Delete all jobs from `jobs` table
     *
     * @returns {Promise<number>}  Number of rows affected
     */
    StorageProvider.prototype.deleteAllJobs = function () {
        if (this.tableJobs === undefined) {
            return Promise.reject('Tables are not initialised');
        }
        return this.tableJobs.sqlDeleteAll();
    };
    /**
     * Delete one job based on row ID from `jobs` table
     *
     * @param {number} id  Row ID
     * @returns {Promise<number>}  Number of rows affected
     */
    StorageProvider.prototype.deleteJob = function (rowId) {
        if (this.tableJobs === undefined) {
            return Promise.reject('Tables are not initialised');
        }
        return this.tableJobs.sqlDelete(rowId);
    };
    /**
     * Set value of particular key
     *
     * @param {string} key  Unique identifier
     * @param {string} value  Value that is linked to the `key`
     * @returns {Promise<number>}  Number of rows affected
     */
    StorageProvider.prototype.setKeyValue = function (key, value) {
        // resolve for setKeyValue if table is not initialised
        if (this.tableKeyVal === undefined) {
            return Promise.resolve(undefined);
        }
        return this.tableKeyVal.sqlSetValue(key, value);
    };
    /**
     * Get value that is mapped to a particular key
     *
     * @param {string} key  Unique identifier
     * @returns {Promise<string>}  Value that is linked to the `key`
     */
    StorageProvider.prototype.getKeyValue = function (key) {
        // resolve for setKeyValue if table is not initialised
        if (this.tableKeyVal === undefined) {
            return Promise.resolve(undefined);
        }
        return this.tableKeyVal.sqlGetValue(key);
    };
    /**
     * Parse column into object.
     * If `val` is JSON object, `val` is returned as an object.
     * If `val` is not JSON object, `val` is returned as it is
     *
     * @private
     * @param {*} val  Value of any column
     * @returns {*}
     */
    StorageProvider.prototype.toJSON = function (val) {
        try {
            return JSON.parse(val);
        }
        catch (e) {
            return val;
        }
    };
    /**
     * Parse column into boolean
     *
     * @private
     * @param {any} val  Value of any column
     * @returns {boolean}
     */
    StorageProvider.prototype.toBool = function (val) {
        return (val === 'true' || val === true) ? true : false;
    };
    /**
     * Create tables if does not exist. If exist, check if the table is the latest version. If
     * table version is outdated, re-create the table
     *
     * @private
     * @returns {Promise<void>}
     */
    StorageProvider.prototype.createTables = function () {
        var _this = this;
        // always try to create key-value table
        return this.tableKeyVal.sqlCreate().then(function () {
            // get current version number for jobs table
            return _this.tableKeyVal.sqlGetValue(_this.tableJobs.name);
        }).then(function (currVersion) {
            console.log("[SQL] Current jobs table database version " + currVersion);
            // check if the current table is outdated
            if (currVersion === undefined || Number(currVersion) < Number(_this.tableJobs.version)) {
                console.log("[SQL] Updating jobs table to version " + _this.tableJobs.version);
                // if outdated or does not exist, create the table
                return _this.tableJobs.sqlDrop().then(function () {
                    return _this.tableJobs.sqlCreate();
                }).then(function () {
                    return _this.tableKeyVal.sqlSetValue(_this.tableJobs.name, String(_this.tableJobs.version));
                });
            }
        }).then(function () { });
    };
    StorageProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_1__ionic_native_sqlite__["a" /* SQLite */]])
    ], StorageProvider);
    return StorageProvider;
}());

//# sourceMappingURL=storage.js.map

/***/ }),

/***/ 217:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AuthProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ionic_native_background_mode__ = __webpack_require__(805);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_rxjs_BehaviorSubject__ = __webpack_require__(806);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_rxjs_BehaviorSubject___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_rxjs_BehaviorSubject__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_moment__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_moment___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_moment__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__globals__ = __webpack_require__(40);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__driver_rest_driver_rest__ = __webpack_require__(112);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__notification_notification__ = __webpack_require__(111);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__user_user_driver__ = __webpack_require__(137);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__storage_storage__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__diagnostic_diagnostic__ = __webpack_require__(218);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__websocket_websocket__ = __webpack_require__(520);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};












var AuthProvider = /** @class */ (function () {
    function AuthProvider(authApi, backgroundMode, diagnostic, driver, notify, storage, websocket) {
        this.authApi = authApi;
        this.backgroundMode = backgroundMode;
        this.diagnostic = diagnostic;
        this.driver = driver;
        this.notify = notify;
        this.storage = storage;
        this.websocket = websocket;
        /**
         * Observable to notify whenever there is authenticated status change
         *
         * @type {BehaviorSubject<boolean>}
         */
        this.notifier = new __WEBPACK_IMPORTED_MODULE_2_rxjs_BehaviorSubject__["BehaviorSubject"](undefined);
        this.forceChangePassword = false;
    }
    /**
     * Logs into server
     *
     * @param {string} username  Username of user
     * @param {string} password  Password of user
     * @returns {Promise<void>}  Throws error (if unable to authenticate)
     */
    AuthProvider.prototype.login = function (username, password) {
        var _this = this;
        return this.authApi.login({ username: username, password: password })
            .then(function (userDetails) {
            _this.initUser(userDetails);
            _this.driver.initDriver(userDetails); // assume user is always driver
        })
            .catch(function (err) {
            _this.resetUser(); // clear any existing data if any
            throw err;
        });
    };
    /**
     * Logs out of server. If there is no Internet, variables will still
     * be reset, but when Internet is established again, the user will be
     * redirected to home page
     *
     * @returns {Promise<any>}
     */
    AuthProvider.prototype.logout = function () {
        var _this = this;
        if (this.username === undefined) {
            this.notifier.next(false); // in case session is removed on server side while using
            return Promise.resolve();
        }
        return this.authApi.logout().then(function () {
            _this.resetUser();
        }).catch(function () {
            _this.resetUser();
            // ignore any server errors
        });
    };
    /**
     * Checks if user is logged in
     *
     * @returns {Promise<void>}  Throws error (if unable to authenticate)
     */
    AuthProvider.prototype.isLoggedIn = function () {
        var _this = this;
        return this.authApi.isLoggedIn()
            .then(function (userDetails) {
            _this.setUser(userDetails);
            _this.driver.setDriver(userDetails); // assume user is always driver
        })
            .catch(function (err) {
            _this.resetUser();
            throw err;
        });
    };
    /**
     * Change user password
     *
     * @param {string} oldPw  Current password
     * @param {string} newPw  New password
     * @returns {Promise<void>}
     */
    AuthProvider.prototype.changePassword = function (oldPw, newPw) {
        return this.authApi.resetPassword({
            oldPassword: oldPw,
            newPassword: newPw,
        });
    };
    /**
     * Initialise user, regardless of role. This function should only be called once
     *
     * @private
     * @param {AuthResponse} userDetails  User object from server
     */
    AuthProvider.prototype.initUser = function (userDetails) {
        console.log('[INIT] Initialising user');
        this.setUser(userDetails);
        if (this.diagnostic.deviceOS === __WEBPACK_IMPORTED_MODULE_10__diagnostic_diagnostic__["b" /* OperatingSystem */].iOS) {
            // android can listen to websocket messages in the background
            this.backgroundMode.enable();
        }
        this.initWebsocketEvents();
    };
    /**
     * Set user details based on settings from server
     *
     * @private
     * @param {AuthResponse} userDetails  User object from server
     */
    AuthProvider.prototype.setUser = function (userDetails) {
        console.log('[INIT] Setting user variables');
        __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.token = userDetails.token;
        this.storage.setKeyValue(__WEBPACK_IMPORTED_MODULE_5__globals__["d" /* StorageKey */].ApiToken, __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.token);
        __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.username = userDetails.username;
        this.username = __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.username;
        this.storage.setKeyValue(__WEBPACK_IMPORTED_MODULE_5__globals__["d" /* StorageKey */].Username, __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.username);
        this.forceChangePassword = userDetails.forceChangePassword;
        this.synchroniseDate(userDetails.serverDate);
        this.notifier.next(true);
    };
    /**
     * Reset user variables, regardless of role
     *
     * @private
     */
    AuthProvider.prototype.resetUser = function () {
        __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.token = '';
        __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.previousJobsInfo = '';
        __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.vehicleId = '';
        __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.vehiclePlateNumber = '';
        __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].user.vehicleUserGroup = '';
        this.storage.setKeyValue(__WEBPACK_IMPORTED_MODULE_5__globals__["d" /* StorageKey */].ApiToken, '');
        this.storage.setKeyValue(__WEBPACK_IMPORTED_MODULE_5__globals__["d" /* StorageKey */].PreviousJobsInfo, '');
        this.username = undefined;
        // for the convenience of subsequent log in, no need to reset storage username
        this.websocket.disconnect();
        this.driver.resetDriver();
        if (this.backgroundMode.isEnabled) {
            this.backgroundMode.disable();
        }
        // even though api intercepter will update notifier to false, but in case no internet connectivity when logout
        this.notifier.next(false);
    };
    /**
     * Synchronise local device datetime with server datetime
     *
     * @private
     * @param {string} serverTime  Date in ISO8601 format
     */
    AuthProvider.prototype.synchroniseDate = function (serverTime) {
        serverTime = Object(__WEBPACK_IMPORTED_MODULE_3_lodash_es__["l" /* trim */])(serverTime);
        if (serverTime) {
            var offset_1 = new Date(serverTime).getTime() - Date.now();
            __WEBPACK_IMPORTED_MODULE_4_moment__["now"] = function () {
                return offset_1 + Date.now();
            };
        }
    };
    /**
     * Initialise all generic users websocket message events
     *
     * @private
     */
    AuthProvider.prototype.initWebsocketEvents = function () {
        var _this = this;
        this.websocket.connect();
        this.websocket.onJSON(__WEBPACK_IMPORTED_MODULE_11__websocket_websocket__["a" /* WebsocketEvent */].Logout, function () {
            _this.notify.error('You are forced to log out. You will be redirected to login page.');
            _this.resetUser();
        });
    };
    AuthProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_6__driver_rest_driver_rest__["a" /* AuthApi */],
            __WEBPACK_IMPORTED_MODULE_1__ionic_native_background_mode__["a" /* BackgroundMode */],
            __WEBPACK_IMPORTED_MODULE_10__diagnostic_diagnostic__["a" /* DiagnosticProvider */],
            __WEBPACK_IMPORTED_MODULE_8__user_user_driver__["a" /* UserDriverProvider */],
            __WEBPACK_IMPORTED_MODULE_7__notification_notification__["a" /* NotificationProvider */],
            __WEBPACK_IMPORTED_MODULE_9__storage_storage__["a" /* StorageProvider */],
            __WEBPACK_IMPORTED_MODULE_11__websocket_websocket__["b" /* WebsocketProvider */]])
    ], AuthProvider);
    return AuthProvider;
}());

//# sourceMappingURL=auth.js.map

/***/ }),

/***/ 218:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return OperatingSystem; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return DiagnosticProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_rxjs_BehaviorSubject__ = __webpack_require__(806);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_rxjs_BehaviorSubject___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_rxjs_BehaviorSubject__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__ionic_native_app_version__ = __webpack_require__(807);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__ionic_native_diagnostic__ = __webpack_require__(808);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__globals__ = __webpack_require__(40);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__driver_rest_driver_rest__ = __webpack_require__(112);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__notification_notification__ = __webpack_require__(111);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};









/**
 * List of supported operating systems
 *
 * @enum {string}
 */
var OperatingSystem;
(function (OperatingSystem) {
    OperatingSystem["Android"] = "android";
    OperatingSystem["iOS"] = "ios";
})(OperatingSystem || (OperatingSystem = {}));
var DiagnosticProvider = /** @class */ (function () {
    function DiagnosticProvider(appVersion, diagnostic, miscApi, notify, platform) {
        var _this = this;
        this.appVersion = appVersion;
        this.diagnostic = diagnostic;
        this.miscApi = miscApi;
        this.notify = notify;
        this.platform = platform;
        /**
         * Observable to notify whenever gps is turned on or off
         *
         * @type {BehaviorSubject<boolean>}
         */
        this.hasLocationNotifier = new __WEBPACK_IMPORTED_MODULE_2_rxjs_BehaviorSubject__["BehaviorSubject"](false);
        this.platform.ready().then(function () {
            // get device operating system
            if (_this.platform.is(OperatingSystem.Android) === true) {
                _this.deviceOS = OperatingSystem.Android;
            }
            else if (_this.platform.is(OperatingSystem.iOS) === true) {
                _this.deviceOS = OperatingSystem.iOS;
            }
            // get device os version
            var platforms = _this.platform.versions();
            _this.deviceVersion = Object(__WEBPACK_IMPORTED_MODULE_3_lodash_es__["c" /* get */])(platforms[_this.deviceOS], 'num');
            // registerLocationStateChangeHandler only detect GPS on Android platform and Location service On or Off on iOS platform
            _this.diagnostic.registerLocationStateChangeHandler(function (state) {
                // getLocationAuthorizationStatus can detect location permission status for both iOS and Android platform
                _this.diagnostic.getLocationAuthorizationStatus().then(function (statusPermission) {
                    var isOnAndroid = (_this.deviceOS === OperatingSystem.Android && state !== _this.diagnostic.locationMode.LOCATION_OFF && statusPermission !== _this.diagnostic.permissionStatus.NOT_REQUESTED);
                    var isOniOS = (_this.deviceOS === OperatingSystem.iOS && (statusPermission === _this.diagnostic.permissionStatus.GRANTED || statusPermission === _this.diagnostic.permissionStatus.GRANTED_WHEN_IN_USE));
                    if (isOnAndroid === true || isOniOS === true) {
                        _this.hasLocationNotifier.next(true);
                    }
                    else {
                        _this.hasLocationNotifier.next(false);
                    }
                });
            });
        });
    }
    /**
     * Compare current installed app version with minimum version specified by server.
     * Default return value is `true` if any error occur
     *
     * @returns {Promise<boolean>}  True if app is updated
     */
    DiagnosticProvider.prototype.isAppUpdated = function () {
        var _this = this;
        if (__WEBPACK_IMPORTED_MODULE_6__globals__["a" /* Globals */].features.forceAppUpdate === false) { // assume app is updated if feature is not enabled
            return Promise.resolve(true);
        }
        else {
            return this.appVersion.getVersionNumber().then(function (version) {
                console.log("[DIAGNOSTIC] Current app version " + version);
                if (version === undefined) {
                    return true;
                }
                else {
                    return _this.miscApi.getLatestAppVersion().then(function (latestVersion) {
                        console.log("[DIAGNOSTIC] Latest app version " + latestVersion);
                        return _this.normalizeVersionNum(version) >= _this.normalizeVersionNum(latestVersion);
                    });
                }
            }).catch(function () { return true; });
        }
    };
    /**
     * Get application package name (e.g. widget id for Android)
     *
     * @returns {Promise<string>}
     */
    DiagnosticProvider.prototype.getPackageName = function () {
        return this.appVersion.getPackageName();
    };
    /**
     * Check if gps is enabled and if app is permitted to get gps coordinates.
     * `.catch()` is not necessary as no errors will be thrown
     *
     * @returns {Promise<boolean>}  True if gps is enabled and permission given
     */
    DiagnosticProvider.prototype.hasLocationPermission = function () {
        var _this = this;
        return this.diagnostic.isLocationAvailable().then(function (available) {
            _this.hasLocationNotifier.next(available);
            return available;
        }).catch(function (err) { return _this.catch('location', err); });
    };
    /**
     * Check if camera exists and if app is permitted to use camera.
     * `.catch()` is not necessary as no errors will be thrown
     *
     * @returns {Promise<boolean>}  True if camera exists and permission given
     */
    DiagnosticProvider.prototype.hasCameraPermission = function () {
        var _this = this;
        return this.diagnostic.isCameraAvailable().catch(function (err) { return _this.catch('camera', err); });
    };
    /**
     * Request for location permission. Toast will appear if app already has permission.
     * `.catch()` is not necessary as no errors will be thrown
     */
    DiagnosticProvider.prototype.requestLocation = function () {
        var _this = this;
        this.diagnostic.isLocationAvailable().then(function (available) {
            if (available === true) {
                _this.hasLocationNotifier.next(available);
                _this.notify.info('Location permission is already enabled.');
            }
            else {
                return _this.diagnostic.getLocationAuthorizationStatus()
                    .then(function (statusPermission) {
                    _this.diagnostic.isLocationEnabled().then(function (isGpsOn) {
                        if (_this.platform.is('android')) {
                            if (!isGpsOn) {
                                // For GPS off but permission is on condition Android Platform
                                _this.diagnostic.switchToLocationSettings();
                            }
                            else if (statusPermission === _this.diagnostic.permissionStatus.DENIED || statusPermission === _this.diagnostic.permissionStatus.DENIED_ALWAYS || statusPermission === _this.diagnostic.permissionStatus.NOT_REQUESTED) {
                                // For location permission is off condition Android Platform
                                _this.diagnostic.switchToLocationSettings();
                            }
                        }
                        else {
                            if (!isGpsOn) {
                                // For GPS is off on iOS platform
                                _this.notify.info('Please go to Setting >> Privacy >> Location Services to turn on your Location service.');
                            }
                            else if (statusPermission === _this.diagnostic.permissionStatus.DENIED || statusPermission === _this.diagnostic.permissionStatus.DENIED_ALWAYS || statusPermission === _this.diagnostic.permissionStatus.NOT_REQUESTED) {
                                // For location permission is off condition iOS platform
                                _this.diagnostic.switchToSettings();
                            }
                        }
                    });
                });
            }
        }).catch(function (err) { return _this.catch('location', err); });
    };
    /**
     * Request for camera permission. Toast will appear if app already has permission.
     * `.catch()` is not necessary as no errors will be thrown
     */
    DiagnosticProvider.prototype.requestCamera = function () {
        var _this = this;
        this.diagnostic.isCameraAvailable().then(function (available) {
            if (available === true) {
                _this.notify.info('Camera permission is already enabled.');
            }
            else {
                _this.diagnostic.requestCameraAuthorization();
            }
        }).catch(function (err) { return _this.catch('camera', err); });
    };
    /**
     * Generic error handler. All errors are counted as resolved (i.e. no errors will be re-thrown)
     *
     * @private
     * @param {('location' | 'camera')} permission  Type of permission that caused the error
     * @param {string} err  Error message
     * @returns {boolean}  Returns `true` always
     */
    DiagnosticProvider.prototype.catch = function (permission, err) {
        // ignore error, can't be helped due to device issue
        if (permission === undefined) {
            this.notify.error("Unable to check " + permission + " permission details " + err);
        }
        return true; // return true to assume promise is resolved
    };
    /**
     * Normalises all version numbering for easier comparison. Returns `0` if version
     * provided is invalid (e.g. contains letters)
     *
     * @private
     * @param {string} version  Original version number, can be
     * @returns {number}
     */
    DiagnosticProvider.prototype.normalizeVersionNum = function (version) {
        var normVersion = Number(Object(__WEBPACK_IMPORTED_MODULE_3_lodash_es__["l" /* trim */])(version).replace(/\./g, ''));
        return isNaN(normVersion) ? 0 : normVersion;
    };
    DiagnosticProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_4__ionic_native_app_version__["a" /* AppVersion */],
            __WEBPACK_IMPORTED_MODULE_5__ionic_native_diagnostic__["a" /* Diagnostic */],
            __WEBPACK_IMPORTED_MODULE_7__driver_rest_driver_rest__["e" /* MiscApi */],
            __WEBPACK_IMPORTED_MODULE_8__notification_notification__["a" /* NotificationProvider */],
            __WEBPACK_IMPORTED_MODULE_1_ionic_angular__["o" /* Platform */]])
    ], DiagnosticProvider);
    return DiagnosticProvider;
}());

//# sourceMappingURL=diagnostic.js.map

/***/ }),

/***/ 219:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return GeolocationProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__globals__ = __webpack_require__(40);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};




var GeolocationProvider = /** @class */ (function () {
    function GeolocationProvider(platform) {
        var _this = this;
        this.platform = platform;
        /**
         * API HTTP Method for background sync
         *
         * @type {string}
         */
        this.apiMethod = 'POST';
        /**
         * API root property name of request body
         *
         * @type {string}
         */
        this.apiRootProperty = 'record';
        /**
         * API request body format for background sync
         *
         * @type {string}
         */
        this.apiFormat = "{\n        \"Lat\": \"<%= latitude %>\",\n        \"Lng\": \"<%= longitude %>\",\n        \"Accuracy\": \"<%= accuracy %>\",\n        \"RecordedTime\": \"<%= timestamp %>\"\n    }";
        /**
         * Common / universal options for geolocation tracking
         *
         * @type {*}
         */
        this.geolocationOptions = {
            // Geolocation config
            desiredAccuracy: 0,
            distanceFilter: 10,
            stationaryRadius: 25,
            // set to true to receive debug push notification message when app is terminated or at background mode
            debug: false,
            // turn off 0 (OFF), set to 5 (VERBOSE) to record log, it is used with maxDaysToPersist
            logLevel: 0,
            // set to true to always apply the supplied config
            reset: true,
            // set to false, device will sleep for 300 seconds if device is in 'still' state, then device will wake up to get location to upload to server.
            // set to true, when device is in 'still' state, not update any location. if device exit 'still' state, it will wait for 15 mins to update location.
            pausesLocationUpdatesAutomatically: false,
            // Activity Recognition config
            activityRecognitionInterval: 10000,
            stopTimeout: 5,
            // Application config
            stopOnTerminate: false,
            startOnBoot: true,
            // iOS
            heartbeatInterval: 60,
            preventSuspend: true,
            locationAuthorizationRequest: 'Always',
            // Android
            foregroundService: true,
            notificationChannelName: 'Location Tracker',
            fastestLocationUpdateInterval: 5000,
            allowIdenticalLocations: true,
            // HTTP / SQLite config
            autoSync: __WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].features.enableGeoTracking,
            httpTimeout: 20000,
            method: this.apiMethod,
            httpRootProperty: this.apiRootProperty,
            locationTemplate: this.apiFormat,
            batchSync: true,
            maxBatchSize: 5000,
            maxDaysToPersist: 2,
            // format is '{DAY(s)} {START_TIME}-{END_TIME}', 1 is Sunday, 7 is Sat
            schedule: [
                '1-7 7:00-23:00',
            ],
        };
        this.platform.ready().then(function () {
            var bgGeo = window.BackgroundGeolocation;
            if (bgGeo !== undefined) { // for web usage
                _this.bgGeo = bgGeo;
                // to be removed //
                _this.bgGeo.on('location', function (msg) { return console.log('[LOCATION] onLocation', msg); }, function (e) { return console.log('[LOCATION] onLocation', e); });
                _this.bgGeo.on('http', function (msg) { return console.log('[LOCATION] onHttp', msg); }, function (e) { return console.log('[LOCATION] onHttpErr', e); });
                // end //
            }
        });
    }
    /**
     * Start background geolocation tracking. Calling this function multiple times will not
     * affect operations. However, the variables will change accordingly.
     *
     * @param {string} vehicleId  Id of the vehicle that is assigned to driver
     * @param {string} vehiclePlateNumber  Plate number of the vehicle that is assigned to driver
     */
    GeolocationProvider.prototype.start = function (vehicleId, vehiclePlateNumber, vehicleUserGroup) {
        var _this = this;
        if (this.bgGeo !== undefined && __WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].features.enableGeoTracking === true) { // for web usage, track only if feature is enabled
            var config = Object.assign({}, this.geolocationOptions, {
                url: __WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].url + "/rest/data/v2.1/vehicleLog",
                headers: (_a = {},
                    _a[__WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].default.apiHeader] = __WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].user.token,
                    _a),
                extras: {
                    VehicleId: vehicleId,
                    PlateNumber: vehiclePlateNumber,
                    VehicleUserGroup: vehicleUserGroup,
                },
            });
            this.bgGeo.setConfig(config).then(function () {
                _this.bgGeo.start();
            }).catch(function (err) { return console.log('[LOCATION] Unable to start background tracking.', err); });
        }
        var _a;
    };
    /**
     * Stop background geolocation tracking
     */
    GeolocationProvider.prototype.stop = function () {
        if (this.bgGeo !== undefined && __WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].features.enableGeoTracking === true) { // for web usage, track only if feature is enabled
            this.bgGeo.stop();
        }
    };
    /**
     * Get current location details. `this.start()` is **not** required in order
     * for this function to work
     *
     * @returns {Promise<ILocation>}
     */
    GeolocationProvider.prototype.getCurrentLocation = function () {
        if (this.bgGeo !== undefined) { // for web usage
            // lower sample count to reduce time taken to get location
            return this.bgGeo.getCurrentPosition({
                timeout: 10,
                maximumAge: 10000,
                samples: 1,
            }).then(function (response) { return ({
                coords: {
                    latitude: Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["c" /* get */])(response, 'coords.latitude'),
                    longitude: Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["c" /* get */])(response, 'coords.longitude'),
                    accuracy: Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["c" /* get */])(response, 'coords.accuracy'),
                },
            }); });
        }
        else {
            return Promise.resolve({
                coords: {
                    latitude: undefined,
                    longitude: undefined,
                    accuracy: undefined,
                },
            });
        }
    };
    GeolocationProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_1_ionic_angular__["o" /* Platform */]])
    ], GeolocationProvider);
    return GeolocationProvider;
}());

//# sourceMappingURL=geolocation.js.map

/***/ }),

/***/ 40:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return MenuName; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "d", function() { return StorageKey; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return ItemInputMethod; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Globals; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__providers_classes_job__ = __webpack_require__(136);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */

/**
 * List of menus identifiers in the application
 *
 * @enum {string}
 */
var MenuName;
(function (MenuName) {
    MenuName["AllJobs"] = "allJobsMenu";
})(MenuName || (MenuName = {}));
/**
 * Key used for key-value pairs in local storage
 *
 * @enum {string}
 */
var StorageKey;
(function (StorageKey) {
    StorageKey["Eula"] = "eula";
    StorageKey["Url"] = "url";
    StorageKey["Username"] = "username";
    StorageKey["ApiToken"] = "token";
    StorageKey["PreviousJobsInfo"] = "previousJobsInfo";
})(StorageKey || (StorageKey = {}));
/**
 * The source of input for items handled page
 *
 * @enum {number}
 */
var ItemInputMethod;
(function (ItemInputMethod) {
    ItemInputMethod[ItemInputMethod["Keyboard"] = 0] = "Keyboard";
    ItemInputMethod[ItemInputMethod["Barcode"] = 1] = "Barcode";
})(ItemInputMethod || (ItemInputMethod = {}));
/**
 * Application-wide configuration / settings and values.
 * Some values need to be defined before compiling.
 * Some values may be overwritten by input from server
 *
 * @class Globals
 */
var Globals = /** @class */ (function () {
    function Globals() {
    }
    Object.defineProperty(Globals, "url", {
        get: function () { return Globals._url; },
        set: function (serverUrl) { Globals._url = serverUrl ? serverUrl.replace(/[\/\\]+$/, '') : ''; } // remove prepended slashes
        ,
        enumerable: true,
        configurable: true
    });
    Globals.defaultUrl = 'http://test.gls.beyondedge.com.sg:82';
    Globals._url = Globals.defaultUrl;
    /**
     * `````````````````````````````````````````````
     * These values must be defined before compiling (will not change at run-time)
     *
     * `````````````````````````````````````````````
     */
    Globals.default = {
        url: Globals.defaultUrl,
        apiHeader: 'x-access-token',
        setApiHeader: true,
    };
    Globals.login = {
        page: 'LoginPage',
        image: {
            path: 'assets/images/logo_company.png',
            height: '50px',
        },
    };
    Globals.home = {
        page: 'HomePage',
        title: 'GLS',
    };
    Globals.features = {
        forceAppUpdate: true,
        /**
         * GUI
         */
        showEula: false,
        showChangeUrl: false,
        showAllJobsMenu: true,
        showPodPhotoTab: true,
        showChangePassword: true,
        showChangeDriverInfo: true,
        showJobsMail: true,
        showJobsReorderBtn: false,
        /**
         * Major features
         */
        enableSSLPinning: true,
        enableWebsocket: true,
        enableGeoTracking: true,
        enableOfflineSync: true,
    };
    /**
     * `````````````````````````````````````````````
     * These values may be overwritten at run-time.
     * Some of these values can be defined in the server's setting file.
     * If not defined in server's setting file, the value here will be used
     *
     * `````````````````````````````````````````````
     */
    Globals.user = {
        username: '',
        token: '',
        previousJobsInfo: '',
        vehicleId: '',
        vehiclePlateNumber: '',
        vehicleUserGroup: '',
    };
    /**
     * TODO: Change [status: string] to [status: JobStatus] and [jobtype: string] to [jobtype: JobType] when fixed
     * https://github.com/Microsoft/TypeScript/issues/13042
     */
    Globals.jobStatusPair = (_a = {},
        _a[__WEBPACK_IMPORTED_MODULE_0__providers_classes_job__["c" /* JobStatus */].Pending] = { title: 'Pending', color: 'blue' },
        _a[__WEBPACK_IMPORTED_MODULE_0__providers_classes_job__["c" /* JobStatus */].Late] = { title: 'Late', color: 'orange' },
        _a[__WEBPACK_IMPORTED_MODULE_0__providers_classes_job__["c" /* JobStatus */].Ontime] = { title: 'Ontime', color: 'green' },
        _a[__WEBPACK_IMPORTED_MODULE_0__providers_classes_job__["c" /* JobStatus */].Unsuccessful] = { title: 'Unsuccessful', color: 'red' },
        _a[__WEBPACK_IMPORTED_MODULE_0__providers_classes_job__["c" /* JobStatus */].ExpectToBeLate] = { title: 'Expect Late', color: 'purple' },
        _a);
    Globals.jobTypePair = (_b = {},
        _b[__WEBPACK_IMPORTED_MODULE_0__providers_classes_job__["d" /* JobType */].Pickup] = { title: 'PICKUP', color: 'orange' },
        _b[__WEBPACK_IMPORTED_MODULE_0__providers_classes_job__["d" /* JobType */].Delivery] = { title: 'DELIVERY', color: 'blue' },
        _b);
    Globals.setting = {
        note: {
            maxNumPhoto: 3,
            optionRequired: false,
            options: [
                'No problem',
                'Incomplete order',
                'Customer unavailable',
                'Damaged product',
            ],
        },
        pod: {
            photoRequired: false,
        },
        item: {
            defaultInput: ItemInputMethod.Keyboard,
            allowSwitchInput: true,
            acceptedCodes: 'DATA_MATRIX,UPC_A,UPC_E,EAN_8,EAN_13,CODE_39,CODE_128,ITF',
        },
    };
    return Globals;
}());

var _a, _b;
//# sourceMappingURL=globals.js.map

/***/ }),

/***/ 520:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "c", function() { return WebsocketPurpose; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return WebsocketEvent; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return WebsocketProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_socket_io_client_dist_socket_io__ = __webpack_require__(1064);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_socket_io_client_dist_socket_io___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_socket_io_client_dist_socket_io__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__globals__ = __webpack_require__(40);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};



/**
 * Possible values for purpose of a websocket message received
 *
 * @enum {string}
 */
var WebsocketPurpose;
(function (WebsocketPurpose) {
    WebsocketPurpose["Create"] = "create";
    WebsocketPurpose["Update"] = "update";
    WebsocketPurpose["Delete"] = "delete";
    WebsocketPurpose["Attempted"] = "attempted";
})(WebsocketPurpose || (WebsocketPurpose = {}));
/**
 * Possible values for event of a websocket message received
 *
 * @enum {string}
 */
var WebsocketEvent;
(function (WebsocketEvent) {
    WebsocketEvent["DeliveryMaster"] = "DeliveryMaster";
    WebsocketEvent["DeliveryDetail"] = "DeliveryDetail";
    WebsocketEvent["DeliveryItem"] = "DeliveryItem";
    WebsocketEvent["DeliveryPlan"] = "DeliveryPlan";
    WebsocketEvent["Vehicle"] = "Vehicle";
    WebsocketEvent["Logout"] = "logout";
})(WebsocketEvent || (WebsocketEvent = {}));
var WebsocketProvider = /** @class */ (function () {
    function WebsocketProvider() {
        this.eventsToCreate = []; // list of events to create when socket is ready
    }
    /**
     * Establish websocket connection to the server
     */
    WebsocketProvider.prototype.connect = function () {
        var _this = this;
        if (__WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].features.enableWebsocket === false) {
            // ignore subsequent codes if feature is not enabled
            return;
        }
        else if (this.socket !== undefined && this.socket.connected === true) {
            console.log("[WEBSOCKET] Already connected to websocket");
        }
        else {
            var serverUrl = __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].url;
            if (__WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].default.setApiHeader) {
                serverUrl += "?" + __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].default.apiHeader + "=" + __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].user.token;
            }
            console.log("[WEBSOCKET] Connecting to " + serverUrl);
            this.socket = __WEBPACK_IMPORTED_MODULE_1_socket_io_client_dist_socket_io__(serverUrl); // needs to be here instead of constructor in case url changes
            if (this.eventsToCreate.length) {
                this.eventsToCreate.forEach(function (event) { return _this.onJSON(event.name, event.successFn, event.errorFn); });
                this.eventsToCreate = [];
            }
        }
    };
    /**
     * Disconnect websocket connectivity
     */
    WebsocketProvider.prototype.disconnect = function () {
        if (__WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].features.enableWebsocket === false) {
            // ignore subsequent codes if feature is not enabled
            return;
        }
        else if (this.socket !== undefined && this.socket.connected === true) {
            // remove listener is not required because connection will be disconnected
            this.socket.disconnect();
        }
    };
    /**
     * Listen to a websocket event
     *
     * @param {WebsocketEvent} eventName  Name of event to listen
     * @param {Function} successCallback  Callback when a message is received
     * @param {Function} [errorCallback]  Callback when an error is received
     */
    WebsocketProvider.prototype.onJSON = function (eventName, successCallback, errorCallback) {
        // https://stackoverflow.com/questions/32875824/socket-io-how-to-replace-event-listener-on-client
        // check if an event has listener (does not allow same topics to be listened more than once)
        if (__WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].features.enableWebsocket === false || this.socket.hasListeners(eventName)) {
            // ignore subsequent codes if feature is not enabled
            return;
        }
        else if (!this.socket) {
            // handles scenario where this function is called before socket is initialised
            this.eventsToCreate.push({ name: eventName, successFn: successCallback, errorFn: errorCallback });
        }
        else {
            this.socket.on(eventName, function (msgStr) {
                try {
                    var msg = JSON.parse(msgStr);
                    console.log("[WEBSOCKET] Event: (" + eventName + "). Message:", msg);
                    if (successCallback) {
                        successCallback(msg);
                    }
                }
                catch (err) {
                    console.log("[WEBSOCKET] Event: (" + eventName + "). Message:", msgStr, err);
                    if (errorCallback) {
                        errorCallback(err);
                    }
                }
            });
        }
    };
    WebsocketProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [])
    ], WebsocketProvider);
    return WebsocketProvider;
}());

//# sourceMappingURL=websocket.js.map

/***/ }),

/***/ 521:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return NativeHTTP; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ionic_native_http__ = __webpack_require__(804);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__angular_common_http__ = __webpack_require__(558);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__globals__ = __webpack_require__(40);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__user_auth__ = __webpack_require__(217);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__ionic_native_network__ = __webpack_require__(220);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_ionic_angular__ = __webpack_require__(39);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};







/**
 * Supported HTTP methods by this interceptor
 *
 * @enum IHTTPMethod
 */
var HTTPMethod;
(function (HTTPMethod) {
    HTTPMethod["GET"] = "get";
    HTTPMethod["POST"] = "post";
    HTTPMethod["PUT"] = "put";
})(HTTPMethod || (HTTPMethod = {}));
// interceptor to prepend server url
var NativeHTTP = /** @class */ (function (_super) {
    __extends(NativeHTTP, _super);
    function NativeHTTP(http, injector, network, platform) {
        var _this = _super.call(this) || this;
        _this.http = http;
        _this.injector = injector;
        _this.network = network;
        _this.platform = platform;
        _this.useNativeHttp = false;
        // use HttpClient if on browser and native HTTP if on mobile platform
        // @see https://github.com/silkimen/cordova-plugin-advanced-http/issues/108
        _this.useNativeHttp = (_this.platform.is('ios') || _this.platform.is('android'));
        console.log("[API] Using Native HTTP " + _this.useNativeHttp);
        return _this;
    }
    NativeHTTP.prototype.get = function (url, parameters, headers) {
        if (parameters === void 0) { parameters = {}; }
        if (headers === void 0) { headers = {}; }
        return this.sendRequestToServer(HTTPMethod.GET, [url, parameters, headers]);
    };
    NativeHTTP.prototype.post = function (url, body, headers) {
        if (headers === void 0) { headers = {}; }
        return this.sendRequestToServer(HTTPMethod.POST, [url, body, headers]);
    };
    NativeHTTP.prototype.put = function (url, body, headers) {
        if (headers === void 0) { headers = {}; }
        return this.sendRequestToServer(HTTPMethod.PUT, [url, body, headers]);
    };
    /**
     * @private
     * @param method  HTTP method to call
     * @param args  Arguments to pass into `method`. First element is always `url`.
     * @returns {Promise<any>}
     */
    NativeHTTP.prototype.sendRequestToServer = function (httpMethod, args) {
        var _this = this;
        var serverUrl = __WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].url;
        var originalUrl = args[0];
        var body = args[1] || {};
        var headers = args[2] || {};
        // set auth header only if indicated in globals file
        if (__WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].default.setApiHeader === true) {
            headers = (_a = {}, _a[__WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].default.apiHeader] = __WEBPACK_IMPORTED_MODULE_3__globals__["a" /* Globals */].user.token, _a);
        }
        // set correct url
        var url = serverUrl + "/" + originalUrl;
        console.log("[API] Sending request to " + url, body, headers);
        if (this.network.type === 'none') {
            return Promise.reject({ error: 'Internet is required.' });
        }
        var promise;
        if (this.useNativeHttp) {
            promise = _super.prototype[httpMethod].call(this, url, body, headers);
        }
        else {
            var options = { withCredentials: true, headers: headers };
            // this section of codes can remove only when issue is resolved
            // @see https://github.com/silkimen/cordova-plugin-advanced-http/issues/108
            if (httpMethod === HTTPMethod.GET) {
                promise = this.http.get(url, Object.assign({ params: body }, options)).toPromise();
            }
            else {
                promise = this.http[httpMethod.toString()](url, body, options).toPromise();
            }
        }
        return promise.then(function (response) {
            console.log("[API] Success " + url, response);
            try {
                return JSON.parse(response.data);
            }
            catch (e) {
                return response;
            }
        }).catch(function (err) {
            console.log("[API] Error " + url, err);
            if (_this.useNativeHttp) {
                try {
                    err.error = JSON.parse(err.error);
                }
                catch (e) { }
            }
            else {
                err.status = -1;
            }
            if (err.status === 401) {
                var auth = _this.injector.get(__WEBPACK_IMPORTED_MODULE_4__user_auth__["a" /* AuthProvider */]); // injected here to prevent cyclic DI error
                auth.logout(); // force logout
            }
            throw err;
        });
        var _a;
    };
    NativeHTTP = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_2__angular_common_http__["a" /* HttpClient */],
            __WEBPACK_IMPORTED_MODULE_0__angular_core__["Injector"],
            __WEBPACK_IMPORTED_MODULE_5__ionic_native_network__["a" /* Network */],
            __WEBPACK_IMPORTED_MODULE_6_ionic_angular__["o" /* Platform */]])
    ], NativeHTTP);
    return NativeHTTP;
}(__WEBPACK_IMPORTED_MODULE_1__ionic_native_http__["a" /* HTTP */]));

//# sourceMappingURL=native-http.js.map

/***/ }),

/***/ 543:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return NavigationProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__globals__ = __webpack_require__(40);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */



/**
 * This class handles all general navigation events, such as page navigation,
 * tab navigation and hardware back button navigation.
 *
 * For normal pages,
 *  - `NavController` is required for page navigation
 *  - `App` is not necessary
 *
 * For tabs,
 *  - `NavController` is required for tab navigation
 *  - `App` is required for page navigation
 *
 * `platform` is required to use any hardware back button related functions
 *
 * @abstract
 * @class NavigationProvider
 * @example
 *  ```
 *  class HomePage extends NavigationProvider {
 *      constructor(
 *          public app: App,
 *          public navCtrl: NavController,
 *          public platform: Platform
 *      ) {
 *          super({ app: app, navCtrl: navCtrl, platform: platform });
 *      }
 *  }
 *  ```
 */
var NavigationProvider = /** @class */ (function () {
    function NavigationProvider(init) {
        this.navOptions = { animate: false, updateUrl: false };
        this.app = init.app;
        this.platform = init.platform;
        // if NavController object has a parent, then the page is a tab
        if (Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["c" /* get */])(init.navCtrl, 'parent')) {
            this.tabsNav = init.navCtrl.parent;
        }
        else {
            this.rootNav = init.navCtrl;
        }
    }
    /**
     * Go to page
     *
     * @param {string} page  Class name of page to go
     * @param {*} [params={}]  Navigation parameters to pass to destination page
     */
    NavigationProvider.prototype.goPage = function (page, params) {
        if (params === void 0) { params = {}; }
        if (this.canNavigate() === true) {
            this.rootNav.push(page, params, this.navOptions);
        }
    };
    /**
     * Return to previous page
     *
     * @param {number} [numPage]  Return to page `numPage` away
     */
    NavigationProvider.prototype.goPreviousPage = function (numPage) {
        if (numPage === void 0) { numPage = 0; }
        if (this.canNavigate() === true) {
            if (numPage === 0) {
                this.rootNav.pop(this.navOptions);
            }
            else {
                // as of 28 march 2018 popTo('page') does not work
                this.rootNav.popTo(this.rootNav.getByIndex(this.rootNav.length() - numPage), this.navOptions);
            }
        }
    };
    /**
     * Set home page as root. Home page is defined in `homePage` variable
     *
     * @param {*} [params={}]  Navigation parameters to pass to home page
     */
    NavigationProvider.prototype.goHomePage = function (params) {
        if (params === void 0) { params = {}; }
        if (this.canNavigate() === true) {
            console.log("[NAVIGATION] Going to " + __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].home.page);
            this.rootNav.setRoot(__WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].home.page, params, this.navOptions);
        }
    };
    /**
     * Set login page as root. Login page is defined in `loginPage` variable
     *
     * @param {*} [params={}]  Navigation parameters to pass to login page
     */
    NavigationProvider.prototype.goLoginPage = function (params) {
        if (params === void 0) { params = {}; }
        if (this.canNavigate() === true) {
            console.log("[NAVIGATION] Going to " + __WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].login.page);
            this.rootNav.setRoot(__WEBPACK_IMPORTED_MODULE_2__globals__["a" /* Globals */].login.page, params, this.navOptions);
        }
    };
    /**
     * Exit application
     */
    NavigationProvider.prototype.exitApp = function () {
        this.platform.exitApp();
    };
    /**
     * Overwrite hardware back button event. Don't provide `onPressed` to disable back
     * button entirely
     *
     * @param {Function} [onPressed=() => { }]  Callback function when back button is pressed
     * @returns {Function}  Function to unregister event
     */
    NavigationProvider.prototype.overwriteBackBtnEvent = function (onPressed) {
        if (onPressed === void 0) { onPressed = function () { }; }
        if (this.platform) {
            return this.platform.registerBackButtonAction(onPressed, 10);
        }
        else {
            console.log('[WARN] platform is not initialised. Failed to disable back button.');
            return function () { };
        }
    };
    /**
     * Go to the next sibiling tab
     */
    NavigationProvider.prototype.goNextTab = function () {
        if ((this.tabsNav instanceof __WEBPACK_IMPORTED_MODULE_0_ionic_angular__["p" /* Tabs */])) {
            var nextTab = this.tabsNav.getByIndex(this.tabsNav.getSelected().index + 1);
            if (nextTab && nextTab.show) {
                nextTab.enabled = true;
                this.tabsNav.select(nextTab, this.navOptions);
                return true;
            }
        }
        else {
            console.log('[WARN] There is no tab to navigate to. Failed to go next tab.');
        }
        return false;
    };
    /**
     * Whether page navigation is allowed
     *
     * @private
     * @returns {boolean}  True if page navigation is allowed
     */
    NavigationProvider.prototype.canNavigate = function () {
        if (!this.rootNav && Object(__WEBPACK_IMPORTED_MODULE_1_lodash_es__["c" /* get */])(this.app, 'getRootNav')) {
            // this needs to be initialised here because app may not be initialised when first passed into constructor
            this.rootNav = this.app.getRootNav();
        }
        return this.rootNav ? true : false;
    };
    return NavigationProvider;
}());

//# sourceMappingURL=navigation.js.map

/***/ }),

/***/ 544:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return LoadingProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__navigation_navigation__ = __webpack_require__(543);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};



var LoadingProvider = /** @class */ (function (_super) {
    __extends(LoadingProvider, _super);
    function LoadingProvider(loadingCtrl, platform) {
        var _this = _super.call(this, { platform: platform }) || this;
        _this.loadingCtrl = loadingCtrl;
        _this.platform = platform;
        return _this;
    }
    /**
     * Show loader and disable back button while showing. Dismiss must be called manually.
     *
     * @param {string} [msg='Please wait']  Custom message to describe loader (if any)
     * @returns {Loading}
     */
    LoadingProvider.prototype.show = function (msg) {
        var _this = this;
        if (msg === void 0) { msg = 'Please wait'; }
        var loader = this.loadingCtrl.create({ content: msg + "..." });
        var btnBackEvent = function () { };
        loader.willEnter.subscribe(function () { return btnBackEvent = _this.overwriteBackBtnEvent(); });
        loader.onDidDismiss(function () { return btnBackEvent(); });
        loader.present();
        return loader;
    };
    LoadingProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_1_ionic_angular__["i" /* LoadingController */],
            __WEBPACK_IMPORTED_MODULE_1_ionic_angular__["o" /* Platform */]])
    ], LoadingProvider);
    return LoadingProvider;
}(__WEBPACK_IMPORTED_MODULE_2__navigation_navigation__["a" /* NavigationProvider */]));

//# sourceMappingURL=loading.js.map

/***/ }),

/***/ 557:
/***/ (function(module, exports) {

function webpackEmptyAsyncContext(req) {
	// Here Promise.resolve().then() is used instead of new Promise() to prevent
	// uncatched exception popping up in devtools
	return Promise.resolve().then(function() {
		throw new Error("Cannot find module '" + req + "'.");
	});
}
webpackEmptyAsyncContext.keys = function() { return []; };
webpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;
module.exports = webpackEmptyAsyncContext;
webpackEmptyAsyncContext.id = 557;

/***/ }),

/***/ 603:
/***/ (function(module, exports, __webpack_require__) {

var map = {
	"../pages/all-jobs/all-jobs.module": [
		1087,
		25
	],
	"../pages/all-jobs/next-day-jobs/next-day-jobs.module": [
		1088,
		24
	],
	"../pages/all-jobs/planner-notes/planner-notes.module": [
		1089,
		23
	],
	"../pages/app-permission/app-permission.module": [
		1090,
		22
	],
	"../pages/complete-job-details/complete-job-details.module": [
		1091,
		21
	],
	"../pages/current-job/add-note/add-note.module": [
		1092,
		20
	],
	"../pages/current-job/current-job.module": [
		1093,
		19
	],
	"../pages/current-job/items-handled/items-handled.module": [
		1094,
		18
	],
	"../pages/current-job/pod/pod-photo/pod-photo.module": [
		1095,
		17
	],
	"../pages/current-job/pod/pod-signature/pod-signature.module": [
		1096,
		0
	],
	"../pages/current-job/pod/pod.module": [
		1097,
		16
	],
	"../pages/current-job/pod/verify-code/verify-code.module": [
		1098,
		15
	],
	"../pages/current-job/summary/summary.module": [
		1099,
		14
	],
	"../pages/customer-service/customer-service.module": [
		1100,
		13
	],
	"../pages/home/home.module": [
		1101,
		12
	],
	"../pages/item-details/item-details.module": [
		1102,
		11
	],
	"../pages/login/check-app-version/check-app-version.module": [
		1103,
		10
	],
	"../pages/login/licence-agreement/licence-agreement.module": [
		1104,
		9
	],
	"../pages/login/login.module": [
		1105,
		8
	],
	"../pages/login/scan-server-url/scan-server-url.module": [
		1106,
		7
	],
	"../pages/settings/change-driver-details/change-driver-details.module": [
		1107,
		6
	],
	"../pages/settings/logout/logout.module": [
		1108,
		5
	],
	"../pages/settings/offline-job-modal/offline-job-modal.module": [
		1109,
		4
	],
	"../pages/settings/offline-sync/offline-sync.module": [
		1110,
		3
	],
	"../pages/settings/reset-password/reset-password.module": [
		1111,
		1
	],
	"../pages/settings/settings.module": [
		1112,
		2
	]
};
function webpackAsyncContext(req) {
	var ids = map[req];
	if(!ids)
		return Promise.reject(new Error("Cannot find module '" + req + "'."));
	return __webpack_require__.e(ids[1]).then(function() {
		return __webpack_require__(ids[0]);
	});
};
webpackAsyncContext.keys = function webpackAsyncContextKeys() {
	return Object.keys(map);
};
webpackAsyncContext.id = 603;
module.exports = webpackAsyncContext;

/***/ }),

/***/ 800:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return DriverNoteKey; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return Note; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_lodash_es__ = __webpack_require__(41);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */

/**
 * Possible key values for driver's note
 *
 * @enum {string}
 */
var DriverNoteKey;
(function (DriverNoteKey) {
    DriverNoteKey["Option"] = "Template";
    DriverNoteKey["FreeText"] = "Comments";
    DriverNoteKey["InputMethod"] = "Input Items By";
    DriverNoteKey["CurrentPosition"] = "ActualDeliveryLocation";
})(DriverNoteKey || (DriverNoteKey = {}));
/**
 * Represents each note object in Note column of each job
 *
 * @class Note
 */
var Note = /** @class */ (function () {
    function Note(init) {
        Object.assign(this, init);
    }
    Object.defineProperty(Note.prototype, "key", {
        get: function () { return this._key; },
        set: function (key) { this._key = key; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Note.prototype, "value", {
        get: function () { return this._value; },
        set: function (val) {
            if (typeof val === 'string') {
                val = Object(__WEBPACK_IMPORTED_MODULE_0_lodash_es__["l" /* trim */])(val).replace(/(\r\n|\n|\r)/gm, '. '); // removes newlines
            }
            this._value = val;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Returns an object without private properties
     *
     * @returns {*}  JSON object
     */
    Note.prototype.toJSON = function () {
        return { key: this._key, value: this.value };
    };
    /**
     * Returns note in string format '<%_KEY_%>:<%_VALUE_%>'
     *
     * @returns {string}
     */
    Note.prototype.toString = function () {
        var valueText = this._value ? this._value : '-';
        if (this.isJson(this._value) === true) {
            valueText = '';
            for (var nestedKey in this._value) {
                valueText += "(" + nestedKey + ") " + this._value[nestedKey] + ". ";
            }
        }
        return this._key + ": " + valueText;
    };
    Note.prototype.isJson = function (item) {
        // this function passes tests for Blob, null, Array, strings, numbers
        return item instanceof Object && item.constructor === Object;
    };
    return Note;
}());

//# sourceMappingURL=note.js.map

/***/ }),

/***/ 855:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return CurrentJobProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ionic_native_base64__ = __webpack_require__(811);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__classes_job__ = __webpack_require__(136);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__classes_note__ = __webpack_require__(800);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__diagnostic_diagnostic__ = __webpack_require__(218);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__geolocation_geolocation__ = __webpack_require__(219);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__user_user_driver__ = __webpack_require__(137);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};









/**
 * Possible actions that a driver can do for a job
 *
 * @enum {number}
 */
var CurrentJobAction;
(function (CurrentJobAction) {
    CurrentJobAction[CurrentJobAction["Success"] = 0] = "Success";
    CurrentJobAction[CurrentJobAction["Fail"] = 1] = "Fail";
})(CurrentJobAction || (CurrentJobAction = {}));
var CurrentJobProvider = /** @class */ (function () {
    function CurrentJobProvider(base64, diagnostic, driver, geolocation, modalCtrl) {
        this.base64 = base64;
        this.diagnostic = diagnostic;
        this.driver = driver;
        this.geolocation = geolocation;
        this.modalCtrl = modalCtrl;
        this.inputByBarcode = false;
        this.items = [];
        this.notePhotos = []; // array of file urls
        this.verified = false;
        this.podSignatureData = []; // temp variable. required because fromDataURL does not work correctly for all devices
    }
    /**
     * Initialise item list based on current job's item list
     *
     * @param {boolean} [forceClear=false]  Set true to set quantity property as 0, otherwise use existing values
     */
    CurrentJobProvider.prototype.initItems = function (forceClear) {
        var _this = this;
        if (forceClear === void 0) { forceClear = false; }
        var details = this.getDetails();
        var overwrite = false; // this handles scenario where delivery item changes after user keys in
        if (forceClear === true || this.items.length === 0) {
            this.inputByBarcode = false;
            overwrite = true;
        }
        this.items = details.DeliveryItems.map(function (_a) {
            var Id = _a.Id, ItemId = _a.ItemId, ItemQty = _a.ItemQty, ActualItemQty = _a.ActualItemQty;
            var qty = ActualItemQty;
            var scanned = [];
            if (overwrite === false) {
                var prevItem = _this.items.find(function (item) { return item.name === ItemId; });
                scanned = prevItem ? prevItem.scanned : [];
                qty = prevItem ? prevItem.actual : ActualItemQty;
            }
            return { id: Id, name: ItemId, expected: ItemQty, actual: qty, scanned: scanned };
        });
    };
    /**
     * Initialise notes based on current job's note values
     *
     * @param {boolean} [forceClear=false]  Set true to reset to '' or server's Note value
     */
    CurrentJobProvider.prototype.initNotes = function (forceClear) {
        if (forceClear === void 0) { forceClear = false; }
        if (forceClear === true || !(this.noteOption || this.noteText)) {
            var details = this.getDetails();
            if (details.NoteFromDriver.length > 0) {
                var prevNoteOption = details.NoteFromDriver.find(function (note) { return note.key === __WEBPACK_IMPORTED_MODULE_5__classes_note__["a" /* DriverNoteKey */].Option; });
                this.noteOption = Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["c" /* get */])(prevNoteOption, 'value');
                var prevNoteText = details.NoteFromDriver.find(function (note) { return note.key === __WEBPACK_IMPORTED_MODULE_5__classes_note__["a" /* DriverNoteKey */].FreeText; });
                this.noteText = Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["c" /* get */])(prevNoteText, 'value');
            }
            this.notePhotos = [];
        }
    };
    /**
     * Get latest job details from driver provider / model to ensure accuracy. Details
     * may change when the job is in the middle of attempting a job
     *
     * @returns {Job}
     */
    CurrentJobProvider.prototype.getDetails = function () {
        var _this = this;
        if (this.id !== undefined) {
            return this.driver.jobs.find(function (job) { return (job.Id === _this.id); });
        }
    };
    /**
     * Indicate that attempting job is successful
     *
     * @param {number} jobId  Id of job
     */
    CurrentJobProvider.prototype.setSuccess = function (jobId) {
        this.id = jobId;
        this.action = (this.action) ? this.action : CurrentJobAction.Success;
    };
    /**
     * Indicate that attempting job is unsuccessful
     *
     * @param {number} jobId  Id of job
     */
    CurrentJobProvider.prototype.setFail = function (jobId) {
        this.id = jobId;
        this.action = (this.action) ? this.action : CurrentJobAction.Fail;
    };
    /**
     * Whether attempting job is successful
     *
     * @returns {boolean}  True if attempting job is successful
     */
    CurrentJobProvider.prototype.isSuccess = function () {
        return (this.action === CurrentJobAction.Success);
    };
    /**
     * Sends request to the server for current attempted job
     *
     * @returns {Promise<void>}  Returns error (if any)
     */
    CurrentJobProvider.prototype.complete = function () {
        var _this = this;
        var job = this.getDetails();
        if (this.isItemsValid(job) === false) {
            return Promise.reject('invalid_items');
        }
        else if (this.driver.isPreviousJobComplete(job) === false) {
            return Promise.reject('Please ensure the previous pickup job has been completed first.');
        }
        else {
            return this.diagnostic.hasLocationPermission().then(function (enabled) {
                if (enabled === true) {
                    return _this.constructRequest();
                }
                else {
                    return new Promise(function (resolve, reject) {
                        var modal = _this.modalCtrl.create('AppPermissionPage', {}, { enableBackdropDismiss: false });
                        modal.onDidDismiss(function () { return _this.constructRequest().then(resolve).catch(reject); });
                        modal.present();
                    });
                }
            }).then(function (attemptedJob) {
                return _this.driver.jobAttempt(attemptedJob);
            }).then(function () { return _this.reset(); });
        }
    };
    /**
     * Reset local variables
     */
    CurrentJobProvider.prototype.reset = function () {
        this.id = undefined;
        this.action = undefined;
        this.inputByBarcode = false;
        this.items = [];
        this.noteOption = undefined;
        this.noteText = undefined;
        this.notePhotos = [];
        this.verified = false;
        this.podSignature = undefined;
        this.podSignatureData = [];
        this.podPhoto = undefined;
    };
    /**
     * Get current location and convert current job data into `AttemptedJob` object
     *
     * @private
     * @returns {Promise<AttemptedJob>}
     */
    CurrentJobProvider.prototype.constructRequest = function () {
        var _this = this;
        console.log('[ATTEMPT] Getting location');
        return Promise.all([
            this.convertPhotosToBase64(),
            this.geolocation.getCurrentLocation().catch(function () { }),
        ]).then(function (results) {
            var base64 = results[0];
            var currentPosition = results[1];
            console.log('[ATTEMPT] Current position is', currentPosition);
            var note = [];
            if (_this.noteOption) {
                note.push(new __WEBPACK_IMPORTED_MODULE_5__classes_note__["b" /* Note */]({ key: __WEBPACK_IMPORTED_MODULE_5__classes_note__["a" /* DriverNoteKey */].Option, value: _this.noteOption }));
            }
            if (_this.noteText) {
                note.push(new __WEBPACK_IMPORTED_MODULE_5__classes_note__["b" /* Note */]({ key: __WEBPACK_IMPORTED_MODULE_5__classes_note__["a" /* DriverNoteKey */].FreeText, value: _this.noteText }));
            }
            if (_this.isSuccess() === true) {
                note.push(new __WEBPACK_IMPORTED_MODULE_5__classes_note__["b" /* Note */]({ key: __WEBPACK_IMPORTED_MODULE_5__classes_note__["a" /* DriverNoteKey */].InputMethod, value: _this.inputByBarcode ? 'Barcode' : 'Text' }));
            }
            if (currentPosition) {
                note.push(new __WEBPACK_IMPORTED_MODULE_5__classes_note__["b" /* Note */]({
                    key: __WEBPACK_IMPORTED_MODULE_5__classes_note__["a" /* DriverNoteKey */].CurrentPosition,
                    value: {
                        lat: Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["c" /* get */])(currentPosition, 'coords.latitude'),
                        lng: Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["c" /* get */])(currentPosition, 'coords.longitude'),
                        accuracy: Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["c" /* get */])(currentPosition, 'coords.accuracy'),
                    },
                }));
            }
            return new __WEBPACK_IMPORTED_MODULE_4__classes_job__["a" /* AttemptedJob */]({
                jobId: _this.id,
                delivered: _this.isSuccess(),
                note: note,
                notePhotosB64: base64.notePhotos,
                items: _this.items.map(function (item) { return ({ Id: item.id, ActualItemQty: item.actual }); }),
                signatureB64: _this.podSignature,
                photoB64: base64.podPhoto,
            });
        });
    };
    /**
     * Check whether the current item list is up-to-date (e.g. in case of websocket changes)
     *
     * @private
     * @param {Job} job  Job to validate
     * @returns {boolean}  True if item list is up-to-date
     */
    CurrentJobProvider.prototype.isItemsValid = function (job) {
        if (this.isSuccess() === false) {
            return true; // not delivered, no need to validate
        }
        else if (this.items.length !== job.DeliveryItems.length) {
            return false; // guaranteed to fail validation
        }
        else {
            return this.items.every(function (item) {
                return !!job.DeliveryItems.find(function (deliveryItem) { return (deliveryItem.Id === item.id && deliveryItem.ItemQty === item.expected); }); // if not found = invalid, return false to exit loop
            });
        }
    };
    /**
     * Convert current job variables that are stored as file path into base64 string
     *
     * @private
     * @returns {Promise<{ podPhoto: string, notePhotos: string[] }>}
     */
    CurrentJobProvider.prototype.convertPhotosToBase64 = function () {
        var _this = this;
        var promises = [this.podPhoto].concat(this.notePhotos);
        return Promise.all(promises.map(function (fullpath) { return _this.fileToB64(fullpath); })).then(function (base64) {
            var podPhoto = base64[0], notePhotos = base64.slice(1);
            return { podPhoto: podPhoto, notePhotos: notePhotos };
        });
    };
    /**
     * Get file path on storage and convert file to base64 string
     *
     * @private
     * @param {string} fullpath  File path on storage
     * @returns {Promise<string>}  Base64 string
     */
    CurrentJobProvider.prototype.fileToB64 = function (fullpath) {
        fullpath = Object(__WEBPACK_IMPORTED_MODULE_2_lodash_es__["l" /* trim */])(fullpath);
        if (!fullpath) {
            return Promise.resolve('');
        }
        else {
            return this.base64.encodeFile(fullpath).catch(function (err) {
                if (err === 'cordova_not_available') {
                    return ''; // for testing on web
                }
                else {
                    throw err;
                }
            });
        }
    };
    CurrentJobProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_1__ionic_native_base64__["a" /* Base64 */],
            __WEBPACK_IMPORTED_MODULE_6__diagnostic_diagnostic__["a" /* DiagnosticProvider */],
            __WEBPACK_IMPORTED_MODULE_8__user_user_driver__["a" /* UserDriverProvider */],
            __WEBPACK_IMPORTED_MODULE_7__geolocation_geolocation__["a" /* GeolocationProvider */],
            __WEBPACK_IMPORTED_MODULE_3_ionic_angular__["k" /* ModalController */]])
    ], CurrentJobProvider);
    return CurrentJobProvider;
}());

//# sourceMappingURL=current-job.js.map

/***/ }),

/***/ 856:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return CameraProvider; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__ionic_native_camera__ = __webpack_require__(809);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__ionic_native_barcode_scanner__ = __webpack_require__(810);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_lodash_es__ = __webpack_require__(41);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__globals__ = __webpack_require__(40);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__notification_notification__ = __webpack_require__(111);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};







var CameraProvider = /** @class */ (function () {
    function CameraProvider(camera, notify, scanner) {
        this.camera = camera;
        this.notify = notify;
        this.scanner = scanner;
        /**
         * Common / universal options to take photo with camera
         *
         * @private
         * @type {CameraOptions}
         */
        this.cameraOptions = {
            quality: 50,
            destinationType: this.camera.DestinationType.FILE_URI,
            encodingType: this.camera.EncodingType.JPEG,
            sourceType: this.camera.PictureSourceType.CAMERA,
            mediaType: this.camera.MediaType.PICTURE,
            allowEdit: true,
            targetWidth: 1200,
            targetHeight: 1200,
            saveToPhotoAlbum: false,
            correctOrientation: true,
        };
        /**
         * Common / universal options to scan barcodes
         *
         * @private
         * @type {BarcodeScannerOptions}
         */
        this.scanOptions = {
            preferFrontCamera: false,
            showFlipCameraButton: true,
            showTorchButton: true,
            torchOn: false,
            disableAnimations: true,
            disableSuccessBeep: true,
            formats: __WEBPACK_IMPORTED_MODULE_5__globals__["a" /* Globals */].setting.item.acceptedCodes,
            // Android only
            resultDisplayDuration: 0,
            prompt: 'Press back button to cancel',
        };
    }
    /**
     * Opens view to take one photo. Displays error in toast (if any)
     *
     * @returns {Promise<string>}  Uri path to image on storage
     */
    CameraProvider.prototype.getPicture = function () {
        var _this = this;
        return this.camera.getPicture(this.cameraOptions).then(function (fileUri) {
            return Object(__WEBPACK_IMPORTED_MODULE_3_ionic_angular__["s" /* normalizeURL */])(fileUri);
        }).catch(function (err) {
            if (err !== 'No Image Selected' && err !== 'cordova_not_available') {
                _this.notify.error(err);
            }
            throw err;
        });
    };
    /**
     * Opens view to scan one barcode. Displays error in toast (if any)
     *
     * @param {boolean} [qrOnly=false]  Set true to scan QR code only
     * @returns {Promise<BarcodeScanResult>}
     */
    CameraProvider.prototype.scanBarcode = function (qrOnly) {
        var _this = this;
        if (qrOnly === void 0) { qrOnly = false; }
        var formats = qrOnly ? { formats: 'QR_CODE' } : {};
        var options = Object.assign({}, this.scanOptions, formats);
        return this.scanner.scan(options).then(function (result) {
            if (result.cancelled === true) {
                throw new Error('cancelled');
            }
            return result;
        }).catch(function (err) {
            if (err.toString() !== 'Error: cancelled') {
                _this.notify.error(Object(__WEBPACK_IMPORTED_MODULE_4_lodash_es__["c" /* get */])(err, 'text', 'Unable to scan.'));
            }
            throw err;
        });
    };
    CameraProvider = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__["Injectable"])(),
        __metadata("design:paramtypes", [__WEBPACK_IMPORTED_MODULE_1__ionic_native_camera__["a" /* Camera */],
            __WEBPACK_IMPORTED_MODULE_6__notification_notification__["a" /* NotificationProvider */],
            __WEBPACK_IMPORTED_MODULE_2__ionic_native_barcode_scanner__["a" /* BarcodeScanner */]])
    ], CameraProvider);
    return CameraProvider;
}());

//# sourceMappingURL=camera.js.map

/***/ }),

/***/ 859:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_platform_browser_dynamic__ = __webpack_require__(860);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__app_module__ = __webpack_require__(876);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */


Object(__WEBPACK_IMPORTED_MODULE_0__angular_platform_browser_dynamic__["a" /* platformBrowserDynamic */])().bootstrapModule(__WEBPACK_IMPORTED_MODULE_1__app_module__["a" /* AppModule */]).catch(function (err) { return console.error(err); });
//# sourceMappingURL=main.js.map

/***/ }),

/***/ 876:
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export HttpLoaderFactory */
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AppModule; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__angular_platform_browser__ = __webpack_require__(94);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__angular_core__ = __webpack_require__(0);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__angular_common_http__ = __webpack_require__(558);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__ngx_translate_core__ = __webpack_require__(545);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__ngx_translate_http_loader__ = __webpack_require__(889);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_ionic_angular__ = __webpack_require__(39);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__ionic_native_app_version__ = __webpack_require__(807);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__ionic_native_background_mode__ = __webpack_require__(805);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__ionic_native_camera__ = __webpack_require__(809);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__ionic_native_barcode_scanner__ = __webpack_require__(810);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__ionic_native_base64__ = __webpack_require__(811);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__ionic_native_diagnostic__ = __webpack_require__(808);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12__ionic_native_http__ = __webpack_require__(804);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_13__ionic_native_keyboard__ = __webpack_require__(851);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_14__ionic_native_launch_navigator__ = __webpack_require__(858);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_15__ionic_native_local_notifications__ = __webpack_require__(801);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_16__ionic_native_network__ = __webpack_require__(220);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_17__ionic_native_photo_viewer__ = __webpack_require__(854);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_18__ionic_native_sqlite__ = __webpack_require__(803);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_19__ionic_native_status_bar__ = __webpack_require__(852);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_20__ionic_native_splash_screen__ = __webpack_require__(853);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_21__app_component__ = __webpack_require__(1086);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_22__providers_user_auth__ = __webpack_require__(217);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_23__providers_driver_rest_native_http__ = __webpack_require__(521);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_24__providers_driver_rest_driver_rest__ = __webpack_require__(112);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_25__providers_camera_camera__ = __webpack_require__(856);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_26__providers_current_job_current_job__ = __webpack_require__(855);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_27__providers_diagnostic_diagnostic__ = __webpack_require__(218);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_28__providers_geolocation_geolocation__ = __webpack_require__(219);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_29__providers_loading_loading__ = __webpack_require__(544);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_30__providers_notification_notification__ = __webpack_require__(111);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_31__providers_storage_storage__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_32__providers_user_user_driver__ = __webpack_require__(137);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_33__providers_websocket_websocket__ = __webpack_require__(520);
/**
 * @license
 * Copyright Singapore Institute of Manufacturing Technology (SIMTech). All Rights Reserved.
 *
 * Unauthorized copying of this file, via any medium is strictly prohibited
 * Proprietary and confidential
 */
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};


































// AoT requires an exported function for factories
function HttpLoaderFactory(httpClient) {
    return new __WEBPACK_IMPORTED_MODULE_4__ngx_translate_http_loader__["a" /* TranslateHttpLoader */](httpClient, './assets/i18n/', '.json');
}
var AppModule = /** @class */ (function () {
    function AppModule() {
    }
    AppModule = __decorate([
        Object(__WEBPACK_IMPORTED_MODULE_1__angular_core__["NgModule"])({
            declarations: [
                __WEBPACK_IMPORTED_MODULE_21__app_component__["a" /* MyApp */],
            ],
            imports: [
                __WEBPACK_IMPORTED_MODULE_0__angular_platform_browser__["a" /* BrowserModule */],
                __WEBPACK_IMPORTED_MODULE_2__angular_common_http__["b" /* HttpClientModule */],
                __WEBPACK_IMPORTED_MODULE_3__ngx_translate_core__["b" /* TranslateModule */].forRoot({
                    loader: {
                        provide: __WEBPACK_IMPORTED_MODULE_3__ngx_translate_core__["a" /* TranslateLoader */],
                        useFactory: HttpLoaderFactory,
                        deps: [__WEBPACK_IMPORTED_MODULE_2__angular_common_http__["a" /* HttpClient */]],
                    },
                }),
                __WEBPACK_IMPORTED_MODULE_5_ionic_angular__["g" /* IonicModule */].forRoot(__WEBPACK_IMPORTED_MODULE_21__app_component__["a" /* MyApp */], {
                    tabsPlacement: 'top',
                    tabsHideOnSubPages: true,
                    scrollAssist: false,
                    autoFocusAssist: false,
                    activator: 'highlight',
                }, {
                    links: [
                        { loadChildren: '../pages/all-jobs/all-jobs.module#AllJobsPageModule', name: 'AllJobsPage', segment: 'all-jobs', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/all-jobs/next-day-jobs/next-day-jobs.module#NextDayJobsPageModule', name: 'NextDayJobsPage', segment: 'next-day-jobs', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/all-jobs/planner-notes/planner-notes.module#PlannerNotesPageModule', name: 'PlannerNotesPage', segment: 'planner-notes', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/app-permission/app-permission.module#AppPermissionPageModule', name: 'AppPermissionPage', segment: 'app-permission', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/complete-job-details/complete-job-details.module#CompleteJobDetailsPageModule', name: 'CompleteJobDetailsPage', segment: 'complete-job-details', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/current-job/add-note/add-note.module#AddNotePageModule', name: 'AddNotePage', segment: 'add-note', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/current-job/current-job.module#CurrentJobPageModule', name: 'CurrentJobPage', segment: 'current-job', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/current-job/items-handled/items-handled.module#ItemsHandledPageModule', name: 'ItemsHandledPage', segment: 'items-handled', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/current-job/pod/pod-photo/pod-photo.module#PodPhotoPageModule', name: 'PodPhotoPage', segment: 'pod-photo', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/current-job/pod/pod-signature/pod-signature.module#PodSignaturePageModule', name: 'PodSignaturePage', segment: 'pod-signature', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/current-job/pod/pod.module#PodPageModule', name: 'PodPage', segment: 'pod', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/current-job/pod/verify-code/verify-code.module#VerifyCodePageModule', name: 'VerifyCodePage', segment: 'verify-code', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/current-job/summary/summary.module#SummaryPageModule', name: 'SummaryPage', segment: 'summary', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/customer-service/customer-service.module#CustomerServicePageModule', name: 'CustomerServicePage', segment: 'customer-service', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/home/home.module#HomePageModule', name: 'HomePage', segment: 'home', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/item-details/item-details.module#ItemDetailsPageModule', name: 'ItemDetailsPage', segment: 'item-details', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/login/check-app-version/check-app-version.module#CheckAppVersionPageModule', name: 'CheckAppVersionPage', segment: 'check-app-version', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/login/licence-agreement/licence-agreement.module#LicenceAgreementPageModule', name: 'LicenceAgreementPage', segment: 'licence-agreement', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/login/login.module#LoginPageModule', name: 'LoginPage', segment: 'login', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/login/scan-server-url/scan-server-url.module#ScanServerUrlPageModule', name: 'ScanServerUrlPage', segment: 'scan-server-url', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/settings/change-driver-details/change-driver-details.module#ChangeDriverDetailsPageModule', name: 'ChangeDriverDetailsPage', segment: 'change-driver-details', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/settings/logout/logout.module#LogoutPageModule', name: 'LogoutPage', segment: 'logout', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/settings/offline-job-modal/offline-job-modal.module#OfflineJobModalPageModule', name: 'OfflineJobModalPage', segment: 'offline-job-modal', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/settings/offline-sync/offline-sync.module#OfflineSyncPageModule', name: 'OfflineSyncPage', segment: 'offline-sync', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/settings/reset-password/reset-password.module#ResetPasswordPageModule', name: 'ResetPasswordPage', segment: 'reset-password', priority: 'low', defaultHistory: [] },
                        { loadChildren: '../pages/settings/settings.module#SettingPageModule', name: 'SettingPage', segment: 'settings', priority: 'low', defaultHistory: [] }
                    ]
                }),
            ],
            bootstrap: [__WEBPACK_IMPORTED_MODULE_5_ionic_angular__["e" /* IonicApp */]],
            entryComponents: [
                __WEBPACK_IMPORTED_MODULE_21__app_component__["a" /* MyApp */],
            ],
            providers: [
                // interceptors
                { provide: __WEBPACK_IMPORTED_MODULE_1__angular_core__["ErrorHandler"], useClass: __WEBPACK_IMPORTED_MODULE_5_ionic_angular__["f" /* IonicErrorHandler */] },
                // utils
                __WEBPACK_IMPORTED_MODULE_25__providers_camera_camera__["a" /* CameraProvider */],
                __WEBPACK_IMPORTED_MODULE_27__providers_diagnostic_diagnostic__["a" /* DiagnosticProvider */],
                __WEBPACK_IMPORTED_MODULE_28__providers_geolocation_geolocation__["a" /* GeolocationProvider */],
                __WEBPACK_IMPORTED_MODULE_29__providers_loading_loading__["a" /* LoadingProvider */],
                __WEBPACK_IMPORTED_MODULE_30__providers_notification_notification__["a" /* NotificationProvider */],
                __WEBPACK_IMPORTED_MODULE_31__providers_storage_storage__["a" /* StorageProvider */],
                __WEBPACK_IMPORTED_MODULE_33__providers_websocket_websocket__["b" /* WebsocketProvider */],
                // http api requests
                __WEBPACK_IMPORTED_MODULE_23__providers_driver_rest_native_http__["a" /* NativeHTTP */],
                __WEBPACK_IMPORTED_MODULE_24__providers_driver_rest_driver_rest__["a" /* AuthApi */],
                __WEBPACK_IMPORTED_MODULE_24__providers_driver_rest_driver_rest__["b" /* ItemApi */],
                __WEBPACK_IMPORTED_MODULE_24__providers_driver_rest_driver_rest__["c" /* JobsApi */],
                __WEBPACK_IMPORTED_MODULE_24__providers_driver_rest_driver_rest__["d" /* MailApi */],
                __WEBPACK_IMPORTED_MODULE_24__providers_driver_rest_driver_rest__["e" /* MiscApi */],
                __WEBPACK_IMPORTED_MODULE_24__providers_driver_rest_driver_rest__["f" /* VehicleApi */],
                // data service
                __WEBPACK_IMPORTED_MODULE_22__providers_user_auth__["a" /* AuthProvider */],
                __WEBPACK_IMPORTED_MODULE_26__providers_current_job_current_job__["a" /* CurrentJobProvider */],
                __WEBPACK_IMPORTED_MODULE_32__providers_user_user_driver__["a" /* UserDriverProvider */],
                // native plugins
                __WEBPACK_IMPORTED_MODULE_6__ionic_native_app_version__["a" /* AppVersion */],
                __WEBPACK_IMPORTED_MODULE_8__ionic_native_camera__["a" /* Camera */],
                __WEBPACK_IMPORTED_MODULE_7__ionic_native_background_mode__["a" /* BackgroundMode */],
                __WEBPACK_IMPORTED_MODULE_9__ionic_native_barcode_scanner__["a" /* BarcodeScanner */],
                __WEBPACK_IMPORTED_MODULE_10__ionic_native_base64__["a" /* Base64 */],
                __WEBPACK_IMPORTED_MODULE_11__ionic_native_diagnostic__["a" /* Diagnostic */],
                __WEBPACK_IMPORTED_MODULE_12__ionic_native_http__["a" /* HTTP */],
                __WEBPACK_IMPORTED_MODULE_13__ionic_native_keyboard__["a" /* Keyboard */],
                __WEBPACK_IMPORTED_MODULE_14__ionic_native_launch_navigator__["a" /* LaunchNavigator */],
                __WEBPACK_IMPORTED_MODULE_15__ionic_native_local_notifications__["a" /* LocalNotifications */],
                __WEBPACK_IMPORTED_MODULE_16__ionic_native_network__["a" /* Network */],
                __WEBPACK_IMPORTED_MODULE_17__ionic_native_photo_viewer__["a" /* PhotoViewer */],
                __WEBPACK_IMPORTED_MODULE_18__ionic_native_sqlite__["a" /* SQLite */],
                __WEBPACK_IMPORTED_MODULE_19__ionic_native_status_bar__["a" /* StatusBar */],
                __WEBPACK_IMPORTED_MODULE_20__ionic_native_splash_screen__["a" /* SplashScreen */],
            ],
        })
    ], AppModule);
    return AppModule;
}());

//# sourceMappingURL=app.module.js.map

/***/ })

},[859]);
//# sourceMappingURL=main.js.map