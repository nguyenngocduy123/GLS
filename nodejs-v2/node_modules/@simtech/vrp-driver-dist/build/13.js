webpackJsonp([13],{426:function(t,n,e){"use strict";function o(t){return r["ɵvid"](0,[(t()(),r["ɵeld"](0,0,null,null,0,"canvas",[],null,null,null,null,null))],null,null)}function i(t){return r["ɵvid"](0,[r["ɵqud"](402653184,1,{signaturePad:0}),r["ɵqud"](402653184,2,{container:0}),(t()(),r["ɵeld"](2,0,null,null,5,"ion-content",[["text-center",""]],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,E.b,E.a)),r["ɵdid"](3,4374528,[[2,4],["signatureContainer",4]],0,C.a,[D.a,M.a,R.a,r.ElementRef,r.Renderer,S.a,T.a,r.NgZone,[2,k.a],[2,L.a]],null,null),(t()(),r["ɵted"](-1,1,["\n    "])),(t()(),r["ɵeld"](5,0,null,1,1,"signature-pad",[],null,[[null,"onEndEvent"]],function(t,n,e){var o=!0;if("onEndEvent"===n){o=!1!==t.component.onDrawComplete()&&o}return o},o,W)),r["ɵdid"](6,1097728,[[1,4]],0,l.SignaturePad,[r.ElementRef],null,{onEndEvent:"onEndEvent"}),(t()(),r["ɵted"](-1,1,["\n"])),(t()(),r["ɵted"](-1,null,["\n\n"])),(t()(),r["ɵeld"](9,0,null,null,32,"ion-footer",[],null,null,null,null,null)),r["ɵdid"](10,16384,null,0,j.a,[D.a,r.ElementRef,r.Renderer,[2,k.a]],null,null),(t()(),r["ɵted"](-1,null,["\n    "])),(t()(),r["ɵeld"](12,0,null,null,28,"ion-grid",[["class","grid"],["no-padding",""]],null,null,null,null,null)),r["ɵdid"](13,16384,null,0,A.a,[],null,null),(t()(),r["ɵted"](-1,null,["\n        "])),(t()(),r["ɵeld"](15,0,null,null,24,"ion-row",[["class","row"]],null,null,null,null,null)),r["ɵdid"](16,16384,null,0,B.a,[],null,null),(t()(),r["ɵted"](-1,null,["\n            "])),(t()(),r["ɵeld"](18,0,null,null,5,"ion-col",[["class","col"],["col-6",""],["no-padding",""]],null,null,null,null,null)),r["ɵdid"](19,16384,null,0,F.a,[],null,null),(t()(),r["ɵted"](-1,null,["\n                "])),(t()(),r["ɵeld"](21,0,null,null,1,"vrp-btn-clear",[],null,[[null,"pressed"]],function(t,n,e){var o=!0;if("pressed"===n){o=!1!==t.component.btnClear()&&o}return o},N.b,N.a)),r["ɵdid"](22,49152,null,0,U.a,[c.a],null,{pressed:"pressed"}),(t()(),r["ɵted"](-1,null,["\n            "])),(t()(),r["ɵted"](-1,null,["\n\n            "])),(t()(),r["ɵeld"](25,0,null,null,13,"ion-col",[["class","col"],["col-6",""],["no-padding",""]],null,null,null,null,null)),r["ɵdid"](26,16384,null,0,F.a,[],null,null),(t()(),r["ɵted"](-1,null,["\n                "])),(t()(),r["ɵeld"](28,0,null,null,9,"button",[["color","secondary"],["full",""],["ion-button",""],["large",""],["no-margin",""]],null,[[null,"tap"]],function(t,n,e){var o=!0;if("tap"===n){o=!1!==t.component.btnConfirm()&&o}return o},O.b,O.a)),r["ɵdid"](29,1097728,null,0,H.a,[[8,""],D.a,r.ElementRef,r.Renderer],{color:[0,"color"],large:[1,"large"],full:[2,"full"]},null),(t()(),r["ɵted"](-1,0,["\n                    "])),(t()(),r["ɵeld"](31,0,null,0,5,"div",[],null,null,null,null,null)),(t()(),r["ɵted"](-1,null,["\n                        "])),(t()(),r["ɵeld"](33,0,null,null,1,"ion-icon",[["name","return-right"],["role","img"]],[[2,"hide",null]],null,null,null,null)),r["ɵdid"](34,147456,null,0,I.a,[D.a,r.ElementRef,r.Renderer],{name:[0,"name"]},null),(t()(),r["ɵted"](35,null,["\n                        ","\n                    "])),r["ɵpid"](131072,J.j,[J.k,r.ChangeDetectorRef]),(t()(),r["ɵted"](-1,0,["\n                "])),(t()(),r["ɵted"](-1,null,["\n            "])),(t()(),r["ɵted"](-1,null,["\n        "])),(t()(),r["ɵted"](-1,null,["\n    "])),(t()(),r["ɵted"](-1,null,["\n"])),(t()(),r["ɵted"](-1,null,["\n"]))],function(t,n){t(n,29,0,"secondary","","");t(n,34,0,"return-right")},function(t,n){t(n,2,0,r["ɵnov"](n,3).statusbarPadding,r["ɵnov"](n,3)._hasRefresher);t(n,33,0,r["ɵnov"](n,34)._hidden);t(n,35,0,r["ɵunv"](n,35,0,r["ɵnov"](n,36).transform("BUTTON.Proceed")))})}Object.defineProperty(n,"__esModule",{value:!0});var r=e(0),a=e(2),s=(e(24),e(469)),l=e(464),u=e(161),h=e(70),c=e(44),d=function(t){function n(n,e,o,i){var r=t.call(this,{navCtrl:o,app:n})||this;return r.app=n,r.currentJob=e,r.navCtrl=o,r.notify=i,r.maxHeight=480,r}return Object(a.__extends)(n,t),n.prototype.ionViewCanEnter=function(){var t=this;if(this.job=this.currentJob.getDetails(),!(this.job instanceof h.b))return setTimeout(function(){return t.goHomePage()}),!1},n.prototype.ionViewWillEnter=function(){this.setDimensions(),this.currentJob.podSignatureData&&this.signaturePad.fromData(this.currentJob.podSignatureData)},n.prototype.onDrawComplete=function(){this.currentJob.podSignatureData=this.signaturePad.toData(),this.currentJob.podSignature=this.signaturePad.toDataURL()},n.prototype.btnConfirm=function(){this.signaturePad.isEmpty()&&this.notify.error("Signature is required.");this.goNextTab()||this.goPage("SummaryPage")},n.prototype.btnClear=function(){this.currentJob.podSignatureData=void 0,this.currentJob.podSignature=void 0,this.signaturePad.clear()},n.prototype.setDimensions=function(){var t=this.container.contentHeight,n=this.container.contentWidth,e=(t<n?t:n)-50;this.signaturePad.set("canvasWidth",e=e>this.maxHeight?this.maxHeight:e),this.signaturePad.set("canvasHeight",e),this.signaturePad.set("backgroundColor","rgb(255,255,255)")},n}(e(152).a),p=e(443),f=function(){return function(){}}(),v=e(358),g=e(359),m=e(360),y=e(361),_=e(362),w=e(363),b=e(364),P=e(365),x=e(366),E=e(367),C=e(27),D=e(3),M=e(5),R=e(10),S=e(9),T=e(31),k=e(6),L=e(26),W=r["ɵcrt"]({encapsulation:2,styles:[],data:{}}),j=e(162),A=e(155),B=e(156),F=e(154),N=e(460),U=e(448),O=e(45),H=e(23),I=e(46),J=e(69),V=r["ɵcrt"]({encapsulation:2,styles:[],data:{}}),q=r["ɵccf"]("page-pod-signature",d,function(t){return r["ɵvid"](0,[(t()(),r["ɵeld"](0,0,null,null,1,"page-pod-signature",[],null,null,null,i,V)),r["ɵdid"](1,49152,null,0,d,[S.a,u.a,L.a,c.a],null,null)],null,null)},{},{},[]),z=e(13),G=e(21),Y=e(158),X=e(444),Z=e(48);e.d(n,"PodSignaturePageModuleNgFactory",function(){return K});var K=r["ɵcmf"](f,[],function(t){return r["ɵmod"]([r["ɵmpd"](512,r.ComponentFactoryResolver,r["ɵCodegenComponentFactoryResolver"],[[8,[v.a,g.a,m.a,y.a,_.a,w.a,b.a,P.a,x.a,q]],[3,r.ComponentFactoryResolver],r.NgModuleRef]),r["ɵmpd"](4608,z.l,z.k,[r.LOCALE_ID,[2,z.t]]),r["ɵmpd"](4608,G.t,G.t,[]),r["ɵmpd"](4608,G.d,G.d,[]),r["ɵmpd"](4608,J.g,J.f,[]),r["ɵmpd"](4608,J.c,J.e,[]),r["ɵmpd"](4608,J.i,J.d,[]),r["ɵmpd"](4608,J.b,J.a,[]),r["ɵmpd"](4608,J.k,J.k,[J.n,J.g,J.c,J.i,J.b,J.l,J.m]),r["ɵmpd"](512,z.b,z.b,[]),r["ɵmpd"](512,G.r,G.r,[]),r["ɵmpd"](512,G.j,G.j,[]),r["ɵmpd"](512,G.p,G.p,[]),r["ɵmpd"](512,Y.a,Y.a,[]),r["ɵmpd"](512,X.a,X.a,[]),r["ɵmpd"](512,J.h,J.h,[]),r["ɵmpd"](512,p.a,p.a,[]),r["ɵmpd"](512,s.SignaturePadModule,s.SignaturePadModule,[]),r["ɵmpd"](512,Y.b,Y.b,[]),r["ɵmpd"](512,f,f,[]),r["ɵmpd"](256,J.m,void 0,[]),r["ɵmpd"](256,J.l,void 0,[]),r["ɵmpd"](256,Z.a,d,[])])})},443:function(t,n,e){"use strict";e.d(n,"a",function(){return o});e(2),e(24),e(444),e(448),e(445),e(450),e(452),e(447),e(446),e(449),e(453);var o=function(){return function(){}}()},444:function(t,n,e){"use strict";e.d(n,"a",function(){return o});e(2),e(451);var o=function(){return function(){}}()},445:function(t,n,e){"use strict";e.d(n,"a",function(){return i});var o=e(2),i=(e(24),function(t){function n(n,e){var o=t.call(this,{navCtrl:e})||this;return o.alertCtrl=n,o.navCtrl=e,o.toLoginPage=!1,o.showDialog=!1,o}return Object(o.__extends)(n,t),n.prototype.goMainPage=function(){var t=this;if(!1===this.showDialog)this.go();else{this.alertCtrl.create({title:"Confirm",subTitle:"Are you sure you want to go main page?",buttons:[{text:"Cancel",role:"cancel"},{text:"Yes",handler:function(){t.go()}}]}).present()}},n.prototype.go=function(){!1===this.toLoginPage?this.goHomePage():this.goLoginPage()},n}(e(152).a))},446:function(t,n,e){"use strict";e.d(n,"a",function(){return i});e(2);var o=e(25),i=function(){function t(){}return t.prototype.ngOnChanges=function(){if(void 0===this.jobtype)throw new Error("Attribute `jobtype` is required.");var t=o.a.jobTypePair[this.jobtype];this.text=t.title,this.color=t.color},t}()},447:function(t,n,e){"use strict";e.d(n,"a",function(){return o});e(2);var o=function(){return function(){}}()},448:function(t,n,e){"use strict";e.d(n,"a",function(){return i});e(2);var o=e(0),i=(e(44),function(){function t(t){this.notify=t,this.pressed=new o.EventEmitter}return t.prototype.btnClear=function(){this.pressed.emit()},t.prototype.showToast=function(){this.notify.info("Press and hold to clear all input")},t}())},449:function(t,n,e){"use strict";e.d(n,"a",function(){return o});e(2),e(153);var o=function(){function t(t){this.photoViewer=t,this.photos=[],this.allowRemove=!1}return t.prototype.ngOnInit=function(){if(void 0===this.photos&&void 0===this.photo)throw new Error("Either `photos` or `photo` must be provided.");if(void 0!==this.photos&&!Array.isArray(this.photos))throw new Error("Attribute `photos` must be an array.");if(void 0!==this.photo&&"string"!=typeof this.photo)throw new Error("Attribute `photo` must be a string.")},t.prototype.btnViewPhoto=function(t){this.photoViewer.show(t)},t.prototype.btnRemovePhoto=function(t){var n=this.photos.indexOf(t,0);n>-1&&this.photos.splice(n,1)},t}()},450:function(t,n,e){"use strict";e.d(n,"a",function(){return i});e(2),e(24);var o=e(70),i=(e(101),function(){function t(t,n){this.loading=t,this.modalCtrl=n,this.showItems=!1}return t.prototype.ngOnInit=function(){if(void 0===this.job||!(this.job instanceof o.b))throw new Error("Attribute `job` must be an instance of Job.")},t.prototype.btnViewItem=function(t){var n=this.loading.show("Getting item information");this.modalCtrl.create("ItemDetailsPage",{deliveryItem:t}).present().then(function(){return n.dismiss()})},t}())},451:function(t,n,e){"use strict";e.d(n,"a",function(){return o});e(2);var o=function(){function t(){}return t.prototype.transform=function(t){return window.Ionic.WebView.convertFileSrc(t)},t}()},452:function(t,n,e){"use strict";e.d(n,"a",function(){return i});e(2);var o=e(70),i=function(){function t(){}return t.prototype.ngOnInit=function(){if(void 0===this.job||!(this.job instanceof o.b))throw new Error("Attribute `job` must be an instance of Job.")},t}()},453:function(t,n,e){"use strict";e.d(n,"a",function(){return r});e(2);var o=e(25),i=e(70),r=function(){function t(){this.showProgress=!1,this.summary=[],this.remainingPercent=100}return t.prototype.ngOnChanges=function(){if(void 0!==this.jobs&&this.jobs.length){if(!(this.jobs[0]instanceof i.b))throw new Error("Attribute `jobs` must be an array of Job instances.");this.reset();var t=this.groupBy(this.jobs,"Status");for(var n in t){var e=t[n],r=o.a.jobStatusPair[n];this.summary.push({title:r.title,color:r.color,count:e.length,percent:this.calPercent(e.length)})}}},t.prototype.toggleLegend=function(){this.showProgress=!this.showProgress},t.prototype.reset=function(){this.showProgress=!1,this.summary=[],this.remainingPercent=100},t.prototype.groupBy=function(t,n){return t.reduce(function(t,e,o,i,r){return void 0===r&&(r=e[n]),(t[r]||(t[r]=[])).push(e),t},{})},t.prototype.calPercent=function(t){var n=Math.ceil(t/this.jobs.length*100);return n<this.remainingPercent?(this.remainingPercent=this.remainingPercent-n,n):this.remainingPercent},t}()},460:function(t,n,e){"use strict";function o(t){return i["ɵvid"](0,[(t()(),i["ɵeld"](0,0,null,null,9,"button",[["color","primary"],["full",""],["ion-button",""],["large",""],["no-margin",""]],null,[[null,"tap"],[null,"press"]],function(t,n,e){var o=!0,i=t.component;if("tap"===n){o=!1!==i.showToast()&&o}if("press"===n){o=!1!==i.btnClear()&&o}return o},r.b,r.a)),i["ɵdid"](1,1097728,null,0,a.a,[[8,""],s.a,i.ElementRef,i.Renderer],{color:[0,"color"],large:[1,"large"],full:[2,"full"]},null),(t()(),i["ɵted"](-1,0,["\n    "])),(t()(),i["ɵeld"](3,0,null,0,5,"div",[],null,null,null,null,null)),(t()(),i["ɵted"](-1,null,["\n        "])),(t()(),i["ɵeld"](5,0,null,null,1,"ion-icon",[["name","trash"],["role","img"]],[[2,"hide",null]],null,null,null,null)),i["ɵdid"](6,147456,null,0,l.a,[s.a,i.ElementRef,i.Renderer],{name:[0,"name"]},null),(t()(),i["ɵted"](7,null,["\n        ","\n    "])),i["ɵpid"](131072,u.j,[u.k,i.ChangeDetectorRef]),(t()(),i["ɵted"](-1,0,["\n"])),(t()(),i["ɵted"](-1,null,["\n"]))],function(t,n){t(n,1,0,"primary","","");t(n,6,0,"trash")},function(t,n){t(n,5,0,i["ɵnov"](n,6)._hidden);t(n,7,0,i["ɵunv"](n,7,0,i["ɵnov"](n,8).transform("BUTTON.Clear")))})}e.d(n,"a",function(){return h}),n.b=o;var i=e(0),r=e(45),a=e(23),s=e(3),l=e(46),u=e(69),h=(e(44),i["ɵcrt"]({encapsulation:2,styles:[],data:{}}))},464:function(t,n,e){"use strict";var o=e(0);n.SignaturePad=function(){function t(t){this.elementRef=t,this.options=this.options||{},this.onBeginEvent=new o.EventEmitter,this.onEndEvent=new o.EventEmitter}return t.prototype.ngAfterContentInit=function(){var t=e(470).default,n=this.elementRef.nativeElement.querySelector("canvas");this.options.canvasHeight&&(n.height=this.options.canvasHeight),this.options.canvasWidth&&(n.width=this.options.canvasWidth),this.signaturePad=new t(n,this.options),this.signaturePad.onBegin=this.onBegin.bind(this),this.signaturePad.onEnd=this.onEnd.bind(this)},t.prototype.resizeCanvas=function(){var t=Math.max(window.devicePixelRatio||1,1),n=this.signaturePad._canvas;n.width=n.offsetWidth*t,n.height=n.offsetHeight*t,n.getContext("2d").scale(t,t),this.signaturePad.clear()},t.prototype.toData=function(){return this.signaturePad.toData()},t.prototype.fromData=function(t){this.signaturePad.fromData(t)},t.prototype.toDataURL=function(t,n){return this.signaturePad.toDataURL(t,n)},t.prototype.fromDataURL=function(t,n){void 0===n&&(n={}),this.signaturePad.fromDataURL(t,n)},t.prototype.clear=function(){this.signaturePad.clear()},t.prototype.isEmpty=function(){return this.signaturePad.isEmpty()},t.prototype.off=function(){this.signaturePad.off()},t.prototype.on=function(){this.signaturePad.on()},t.prototype.set=function(t,n){switch(t){case"canvasHeight":this.signaturePad._canvas.height=n;break;case"canvasWidth":this.signaturePad._canvas.width=n;break;default:this.signaturePad[t]=n}},t.prototype.onBegin=function(){this.onBeginEvent.emit(!0)},t.prototype.onEnd=function(){this.onEndEvent.emit(!0)},t.decorators=[{type:o.Component,args:[{template:"<canvas></canvas>",selector:"signature-pad"}]}],t.ctorParameters=[{type:o.ElementRef}],t.propDecorators={options:[{type:o.Input}],onBeginEvent:[{type:o.Output}],onEndEvent:[{type:o.Output}]},t}()},469:function(t,n,e){"use strict";var o=e(0),i=e(464);n.SignaturePadModule=function(){function t(){}return t.decorators=[{type:o.NgModule,args:[{imports:[],declarations:[i.SignaturePad],exports:[i.SignaturePad]}]}],t.ctorParameters=[],t}()},470:function(t,n,e){"use strict";function o(t,n,e){this.x=t,this.y=n,this.time=e||(new Date).getTime()}function i(t,n,e,o){this.startPoint=t,this.control1=n,this.control2=e,this.endPoint=o}function r(t,n){var e=this,o=n||{};this.velocityFilterWeight=o.velocityFilterWeight||.7,this.minWidth=o.minWidth||.5,this.maxWidth=o.maxWidth||2.5,this.throttle="throttle"in o?o.throttle:16,this.minDistance="minDistance"in o?o.minDistance:5,this._strokeMoveUpdate=this.throttle?function(t,n,e){var o,i,r,a=null,s=0;e||(e={});var l=function(){s=!1===e.leading?0:Date.now(),a=null,r=t.apply(o,i),a||(o=i=null)};return function(){var u=Date.now();s||!1!==e.leading||(s=u);var h=n-(u-s);return o=this,i=arguments,h<=0||h>n?(a&&(clearTimeout(a),a=null),s=u,r=t.apply(o,i),a||(o=i=null)):a||!1===e.trailing||(a=setTimeout(l,h)),r}}(r.prototype._strokeUpdate,this.throttle):r.prototype._strokeUpdate,this.dotSize=o.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=o.penColor||"black",this.backgroundColor=o.backgroundColor||"rgba(0,0,0,0)",this.onBegin=o.onBegin,this.onEnd=o.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(t){1===t.which&&(e._mouseButtonDown=!0,e._strokeBegin(t))},this._handleMouseMove=function(t){e._mouseButtonDown&&e._strokeMoveUpdate(t)},this._handleMouseUp=function(t){1===t.which&&e._mouseButtonDown&&(e._mouseButtonDown=!1,e._strokeEnd(t))},this._handleTouchStart=function(t){if(1===t.targetTouches.length){e._strokeBegin(t.changedTouches[0])}},this._handleTouchMove=function(t){t.preventDefault();e._strokeMoveUpdate(t.targetTouches[0])},this._handleTouchEnd=function(t){t.target===e._canvas&&(t.preventDefault(),e._strokeEnd(t))},this.on()}Object.defineProperty(n,"__esModule",{value:!0}),o.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1},o.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},o.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time},i.prototype.length=function(){for(var t=0,n=void 0,e=void 0,o=0;o<=10;o+=1){var i=o/10,r=this._point(i,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),a=this._point(i,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(o>0){var s=r-n,l=a-e;t+=Math.sqrt(s*s+l*l)}n=r,e=a}return t},i.prototype._point=function(t,n,e,o,i){return n*(1-t)*(1-t)*(1-t)+3*e*(1-t)*(1-t)*t+3*o*(1-t)*t*t+i*t*t*t},r.prototype.clear=function(){var t=this._ctx,n=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,n.width,n.height),t.fillRect(0,0,n.width,n.height),this._data=[],this._reset(),this._isEmpty=!0},r.prototype.fromDataURL=function(t){var n=this,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=new Image,i=e.ratio||window.devicePixelRatio||1,r=e.width||this._canvas.width/i,a=e.height||this._canvas.height/i;this._reset(),o.src=t,o.onload=function(){n._ctx.drawImage(o,0,0,r,a)},this._isEmpty=!1},r.prototype.toDataURL=function(t){var n;switch(t){case"image/svg+xml":return this._toSVG();default:for(var e=arguments.length,o=Array(e>1?e-1:0),i=1;i<e;i++)o[i-1]=arguments[i];return(n=this._canvas).toDataURL.apply(n,[t].concat(o))}},r.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},r.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},r.prototype.isEmpty=function(){return this._isEmpty},r.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),"function"==typeof this.onBegin&&this.onBegin(t)},r.prototype._strokeUpdate=function(t){var n=this._createPoint(t.clientX,t.clientY),e=this._data[this._data.length-1],o=e&&e[e.length-1],i=o&&n.distanceTo(o)<this.minDistance;if(!o||!i){var r=this._addPoint(n),a=r.curve,s=r.widths;a&&s&&this._drawCurve(a,s.start,s.end),this._data[this._data.length-1].push({x:n.x,y:n.y,time:n.time,color:this.penColor})}},r.prototype._strokeEnd=function(t){var n=this.points[0];if(!(this.points.length>2)&&n&&this._drawDot(n),n){var e=this._data[this._data.length-1];n.equals(e[e.length-1])||e.push({x:n.x,y:n.y,time:n.time,color:this.penColor})}"function"==typeof this.onEnd&&this.onEnd(t)},r.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},r.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},r.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},r.prototype._createPoint=function(t,n,e){var i=this._canvas.getBoundingClientRect();return new o(t-i.left,n-i.top,e||(new Date).getTime())},r.prototype._addPoint=function(t){var n=this.points,e=void 0;if(n.push(t),n.length>2){3===n.length&&n.unshift(n[0]);var o=(e=this._calculateCurveControlPoints(n[0],n[1],n[2])).c2;e=this._calculateCurveControlPoints(n[1],n[2],n[3]);var r=new i(n[1],o,e.c1,n[2]),a=this._calculateCurveWidths(r);return n.shift(),{curve:r,widths:a}}return{}},r.prototype._calculateCurveControlPoints=function(t,n,e){var i=t.x-n.x,r=t.y-n.y,a=n.x-e.x,s=n.y-e.y,l=(t.x+n.x)/2,u=(t.y+n.y)/2,h=(n.x+e.x)/2,c=(n.y+e.y)/2,d=Math.sqrt(i*i+r*r),p=Math.sqrt(a*a+s*s),f=p/(d+p),v=n.x-(h+(l-h)*f),g=n.y-(c+(u-c)*f);return{c1:new o(l+v,u+g),c2:new o(h+v,c+g)}},r.prototype._calculateCurveWidths=function(t){var n={start:null,end:null},e=this.velocityFilterWeight*t.endPoint.velocityFrom(t.startPoint)+(1-this.velocityFilterWeight)*this._lastVelocity,o=this._strokeWidth(e);return n.start=this._lastWidth,n.end=o,this._lastVelocity=e,this._lastWidth=o,n},r.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)},r.prototype._drawPoint=function(t,n,e){var o=this._ctx;o.moveTo(t,n),o.arc(t,n,e,0,2*Math.PI,!1),this._isEmpty=!1},r.prototype._drawCurve=function(t,n,e){var o=this._ctx,i=e-n,r=Math.floor(t.length());o.beginPath();for(var a=0;a<r;a+=1){var s=a/r,l=s*s,u=l*s,h=1-s,c=h*h,d=c*h,p=d*t.startPoint.x;p+=3*c*s*t.control1.x,p+=3*h*l*t.control2.x;var f=d*t.startPoint.y;f+=3*c*s*t.control1.y,f+=3*h*l*t.control2.y;this._drawPoint(p+=u*t.endPoint.x,f+=u*t.endPoint.y,n+u*i)}o.closePath(),o.fill()},r.prototype._drawDot=function(t){var n=this._ctx,e="function"==typeof this.dotSize?this.dotSize():this.dotSize;n.beginPath(),this._drawPoint(t.x,t.y,e),n.closePath(),n.fill()},r.prototype._fromData=function(t,n,e){for(var i=0;i<t.length;i+=1){var r=t[i];if(r.length>1)for(var a=0;a<r.length;a+=1){var s=r[a],l=new o(s.x,s.y,s.time),u=s.color;if(0===a)this.penColor=u,this._reset(),this._addPoint(l);else if(a!==r.length-1){var h=this._addPoint(l),c=h.curve,d=h.widths;c&&d&&n(c,d,u)}}else{this._reset();e(r[0])}}},r.prototype._toSVG=function(){var t=this,n=this._data,e=this._canvas,o=Math.max(window.devicePixelRatio||1,1),i=e.width/o,r=e.height/o,a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"width",e.width),a.setAttributeNS(null,"height",e.height),this._fromData(n,function(t,n,e){var o=document.createElement("path");if(!(isNaN(t.control1.x)||isNaN(t.control1.y)||isNaN(t.control2.x)||isNaN(t.control2.y))){var i="M "+t.startPoint.x.toFixed(3)+","+t.startPoint.y.toFixed(3)+" C "+t.control1.x.toFixed(3)+","+t.control1.y.toFixed(3)+" "+t.control2.x.toFixed(3)+","+t.control2.y.toFixed(3)+" "+t.endPoint.x.toFixed(3)+","+t.endPoint.y.toFixed(3);o.setAttribute("d",i),o.setAttribute("stroke-width",(2.25*n.end).toFixed(3)),o.setAttribute("stroke",e),o.setAttribute("fill","none"),o.setAttribute("stroke-linecap","round"),a.appendChild(o)}},function(n){var e=document.createElement("circle"),o="function"==typeof t.dotSize?t.dotSize():t.dotSize;e.setAttribute("r",o),e.setAttribute("cx",n.x),e.setAttribute("cy",n.y),e.setAttribute("fill",n.color),a.appendChild(e)});var s='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 '+i+" "+r+'" width="'+i+'" height="'+r+'">',l=a.innerHTML;if(void 0===l){var u=document.createElement("dummy"),h=a.childNodes;u.innerHTML="";for(var c=0;c<h.length;c+=1)u.appendChild(h[c].cloneNode(!0));l=u.innerHTML}var d=s+l+"</svg>";return"data:image/svg+xml;base64,"+btoa(d)},r.prototype.fromData=function(t){var n=this;this.clear(),this._fromData(t,function(t,e){return n._drawCurve(t,e.start,e.end)},function(t){return n._drawDot(t)}),this._data=t},r.prototype.toData=function(){return this._data},n.default=r}});